
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Spyglass Documentation">
      
      
        <meta name="author" content="CBroz1">
      
      
        <link rel="canonical" href="https://lorenfranklab.github.io/spyglass/latest/api/src/spyglass/spikesorting/spikesorting_recording/">
      
      
        <link rel="prev" href="../spikesorting_curation/">
      
      
        <link rel="next" href="../spikesorting_sorting/">
      
      <link rel="icon" href="../../../../../images/Spyglass.svg">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.17">
    
    
      
        <title>spikesorting_recording.py - Spyglass</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="auto" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.spyglass.spikesorting.spikesorting_recording" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Spyglass" class="md-header__button md-logo" aria-label="Spyglass" data-md-component="logo">
      
  <img src="../../../../../images/FrankLab.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spyglass
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              spikesorting_recording.py
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="auto" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: slate)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/LorenFrankLab/spyglass" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Spyglass" class="md-nav__button md-logo" aria-label="Spyglass" data-md-component="logo">
      
  <img src="../../../../../images/FrankLab.png" alt="logo">

    </a>
    Spyglass
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LorenFrankLab/spyglass" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../installation/" class="md-nav__link">
        Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../installation/local/" class="md-nav__link">
        Local
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../installation/production/" class="md-nav__link">
        Productions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/00_intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/01_spikesorting/" class="md-nav__link">
        Spike Sorting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/02_curation/" class="md-nav__link">
        Curation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/03_lfp/" class="md-nav__link">
        LFP
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Position
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Position
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/4_position_info/" class="md-nav__link">
        Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/04_Trodes_position/" class="md-nav__link">
        Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/05_DLC_from_scratch/" class="md-nav__link">
        From Scratch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/06_DLC_from_dir/" class="md-nav__link">
        From Pre-Trained
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/07_linearization/" class="md-nav__link">
        Linearization Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/08_Extract_Mark_indicators/" class="md-nav__link">
        Mark Indicators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/09_Decoding_with_GPUs_on_the_GPU_cluster/" class="md-nav__link">
        GPU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/10_1D_Clusterless_Decoding/" class="md-nav__link">
        1D Clusterless Decoding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/11_2D_Clusterless_Decoding/" class="md-nav__link">
        2D Clusterless Decoding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/12_Ripple_Detection/" class="md-nav__link">
        Ripple Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/docker_mysql_tutorial/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notebooks/Spyglass_kachery_setup/" class="md-nav__link">
        Spyglass Kachery Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          src
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          src
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
          spyglass
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_1_1">
          <span class="md-nav__icon md-icon"></span>
          spyglass
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../_version/" class="md-nav__link">
        _version.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_2" id="__nav_4_1_1_2_label" tabindex="0">
          cli
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_2">
          <span class="md-nav__icon md-icon"></span>
          cli
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/cli/" class="md-nav__link">
        cli.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_3" id="__nav_4_1_1_3_label" tabindex="0">
          common
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_3">
          <span class="md-nav__icon md-icon"></span>
          common
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_backup/" class="md-nav__link">
        common_backup.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_behav/" class="md-nav__link">
        common_behav.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_device/" class="md-nav__link">
        common_device.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_dio/" class="md-nav__link">
        common_dio.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_ephys/" class="md-nav__link">
        common_ephys.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_filter/" class="md-nav__link">
        common_filter.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_interval/" class="md-nav__link">
        common_interval.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_lab/" class="md-nav__link">
        common_lab.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_nwbfile/" class="md-nav__link">
        common_nwbfile.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_position/" class="md-nav__link">
        common_position.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_region/" class="md-nav__link">
        common_region.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_ripple/" class="md-nav__link">
        common_ripple.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_sensors/" class="md-nav__link">
        common_sensors.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_session/" class="md-nav__link">
        common_session.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_subject/" class="md-nav__link">
        common_subject.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/common_task/" class="md-nav__link">
        common_task.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/errors/" class="md-nav__link">
        errors.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/populate_all_common/" class="md-nav__link">
        populate_all_common.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_3_19" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_3_19" id="__nav_4_1_1_3_19_label" tabindex="0">
          prepopulate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_3_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_3_19">
          <span class="md-nav__icon md-icon"></span>
          prepopulate
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/prepopulate/prepopulate/" class="md-nav__link">
        prepopulate.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../common/signal_processing/" class="md-nav__link">
        signal_processing.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_4" id="__nav_4_1_1_4_label" tabindex="0">
          data_import
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_4">
          <span class="md-nav__icon md-icon"></span>
          data_import
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data_import/insert_sessions/" class="md-nav__link">
        insert_sessions.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data_import/storage_dirs/" class="md-nav__link">
        storage_dirs.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_5" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_5" id="__nav_4_1_1_5_label" tabindex="0">
          decoding
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_5">
          <span class="md-nav__icon md-icon"></span>
          decoding
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/clusterless/" class="md-nav__link">
        clusterless.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/core/" class="md-nav__link">
        core.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/dj_decoder_conversion/" class="md-nav__link">
        dj_decoder_conversion.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/sorted_spikes/" class="md-nav__link">
        sorted_spikes.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/visualization/" class="md-nav__link">
        visualization.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/visualization_1D_view/" class="md-nav__link">
        visualization_1D_view.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/visualization_2D_view/" class="md-nav__link">
        visualization_2D_view.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_6" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_6" id="__nav_4_1_1_6_label" tabindex="0">
          figurl_views
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_6">
          <span class="md-nav__icon md-icon"></span>
          figurl_views
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../figurl_views/SpikeSortingRecordingView/" class="md-nav__link">
        SpikeSortingRecordingView.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../figurl_views/SpikeSortingView/" class="md-nav__link">
        SpikeSortingView.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../figurl_views/prepare_spikesortingview_data/" class="md-nav__link">
        prepare_spikesortingview_data.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_7" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_7" id="__nav_4_1_1_7_label" tabindex="0">
          lfp
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_7">
          <span class="md-nav__icon md-icon"></span>
          lfp
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lfp/lfp_merge/" class="md-nav__link">
        lfp_merge.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_7_2" id="__nav_4_1_1_7_2_label" tabindex="0">
          v1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_7_2">
          <span class="md-nav__icon md-icon"></span>
          v1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lfp/v1/lfp/" class="md-nav__link">
        lfp.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lfp/v1/lfp_artifact/" class="md-nav__link">
        lfp_artifact.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lfp/v1/lfp_artifact_MAD_detection/" class="md-nav__link">
        lfp_artifact_MAD_detection.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lfp/v1/lfp_artifact_difference_detection/" class="md-nav__link">
        lfp_artifact_difference_detection.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_8" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_8" id="__nav_4_1_1_8_label" tabindex="0">
          lfp_band
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_8">
          <span class="md-nav__icon md-icon"></span>
          lfp_band
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lfp_band/lfp_band_merge/" class="md-nav__link">
        lfp_band_merge.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_8_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_8_2" id="__nav_4_1_1_8_2_label" tabindex="0">
          v1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_8_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_8_2">
          <span class="md-nav__icon md-icon"></span>
          v1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lfp_band/v1/lfp_band/" class="md-nav__link">
        lfp_band.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_9" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_9" id="__nav_4_1_1_9_label" tabindex="0">
          lock
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_9">
          <span class="md-nav__icon md-icon"></span>
          lock
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lock/file_lock/" class="md-nav__link">
        file_lock.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_10" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_10" id="__nav_4_1_1_10_label" tabindex="0">
          position
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_10">
          <span class="md-nav__icon md-icon"></span>
          position
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/position_merge/" class="md-nav__link">
        position_merge.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_10_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_10_2" id="__nav_4_1_1_10_2_label" tabindex="0">
          v1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_10_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_10_2">
          <span class="md-nav__icon md-icon"></span>
          v1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/dlc_decorators/" class="md-nav__link">
        dlc_decorators.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/dlc_reader/" class="md-nav__link">
        dlc_reader.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/dlc_utils/" class="md-nav__link">
        dlc_utils.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_centroid/" class="md-nav__link">
        position_dlc_centroid.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_cohort/" class="md-nav__link">
        position_dlc_cohort.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_model/" class="md-nav__link">
        position_dlc_model.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_orient/" class="md-nav__link">
        position_dlc_orient.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_pose_estimation/" class="md-nav__link">
        position_dlc_pose_estimation.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_position/" class="md-nav__link">
        position_dlc_position.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_project/" class="md-nav__link">
        position_dlc_project.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_selection/" class="md-nav__link">
        position_dlc_selection.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_dlc_training/" class="md-nav__link">
        position_dlc_training.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position/v1/position_trodes_position/" class="md-nav__link">
        position_trodes_position.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/" class="md-nav__link">
        settings.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_12" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_12" id="__nav_4_1_1_12_label" tabindex="0">
          sharing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_12">
          <span class="md-nav__icon md-icon"></span>
          sharing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sharing/sharing_kachery/" class="md-nav__link">
        sharing_kachery.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1_13" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_13" id="__nav_4_1_1_13_label" tabindex="0">
          spikesorting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_13_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_1_1_13">
          <span class="md-nav__icon md-icon"></span>
          spikesorting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../curation_figurl/" class="md-nav__link">
        curation_figurl.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../merged_sorting_extractor/" class="md-nav__link">
        merged_sorting_extractor.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sortingview/" class="md-nav__link">
        sortingview.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sortingview_helper_fn/" class="md-nav__link">
        sortingview_helper_fn.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spikesorting_artifact/" class="md-nav__link">
        spikesorting_artifact.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spikesorting_curation/" class="md-nav__link">
        spikesorting_curation.py
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          spikesorting_recording.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        spikesorting_recording.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording" class="md-nav__link">
    src.spyglass.spikesorting.spikesorting_recording
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.dj_replace" class="md-nav__link">
    dj_replace()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.IntervalList" class="md-nav__link">
    IntervalList
  </a>
  
    <nav class="md-nav" aria-label="IntervalList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_interval.IntervalList.insert_from_nwbfile" class="md-nav__link">
    insert_from_nwbfile()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup" class="md-nav__link">
    SortGroup
  </a>
  
    <nav class="md-nav" aria-label="SortGroup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_group_by_shank" class="md-nav__link">
    set_group_by_shank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_group_by_electrode_group" class="md-nav__link">
    set_group_by_electrode_group()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_reference_from_list" class="md-nav__link">
    set_reference_from_list()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.get_geometry" class="md-nav__link">
    get_geometry()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.Nwbfile" class="md-nav__link">
    Nwbfile
  </a>
  
    <nav class="md-nav" aria-label="Nwbfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.Nwbfile.insert_from_relative_file_name" class="md-nav__link">
    insert_from_relative_file_name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.Nwbfile.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.Nwbfile.add_to_lock" class="md-nav__link">
    add_to_lock()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.Nwbfile.cleanup" class="md-nav__link">
    cleanup()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.LabTeam" class="md-nav__link">
    LabTeam
  </a>
  
    <nav class="md-nav" aria-label="LabTeam">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_lab.LabTeam.create_new_team" class="md-nav__link">
    create_new_team()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.Electrode" class="md-nav__link">
    Electrode
  </a>
  
    <nav class="md-nav" aria-label="Electrode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_ephys.Electrode.create_from_config" class="md-nav__link">
    create_from_config()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.intervals_by_length" class="md-nav__link">
    intervals_by_length()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.interval_list_intersect" class="md-nav__link">
    interval_list_intersect()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.Probe" class="md-nav__link">
    Probe
  </a>
  
    <nav class="md-nav" aria-label="Probe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_device.Probe.insert_from_nwbfile" class="md-nav__link">
    insert_from_nwbfile()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_device.Probe.get_all_probe_names" class="md-nav__link">
    get_all_probe_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_device.Probe.create_from_nwbfile" class="md-nav__link">
    create_from_nwbfile()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.union_adjacent_index" class="md-nav__link">
    union_adjacent_index()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.spikesorting.spikesorting_recording.SpikeSortingRecording" class="md-nav__link">
    SpikeSortingRecording
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spikesorting_sorting/" class="md-nav__link">
        spikesorting_sorting.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_14" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_14" id="__nav_4_1_1_14_label" tabindex="0">
          utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_14">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/dj_helper_fn/" class="md-nav__link">
        dj_helper_fn.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/dj_merge_tables/" class="md-nav__link">
        dj_merge_tables.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/nwb_helper_fn/" class="md-nav__link">
        nwb_helper_fn.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../contribute/" class="md-nav__link">
        How to Contribute
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../misc/figurl_views/" class="md-nav__link">
        FigURL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../misc/session_groups/" class="md-nav__link">
        Session Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../misc/insert_data/" class="md-nav__link">
        Insert Data
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../CHANGELOG/" class="md-nav__link">
        Change Log
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../LICENSE/" class="md-nav__link">
        Copyright
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>spikesorting_recording.py</h1>

<div class="doc doc-object doc-module">


<a id="src.spyglass.spikesorting.spikesorting_recording"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.dj_replace" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dj_replace</span><span class="p">(</span><span class="n">original_table</span><span class="p">,</span> <span class="n">new_values</span><span class="p">,</span> <span class="n">key_column</span><span class="p">,</span> <span class="n">replace_column</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.dj_replace" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Given the output of a fetch() call from a schema and a 2D array made up
of (key_value, replace_value) tuples, find each instance of key_value in
the key_column of the original table and replace the specified
replace_column with the associated replace_value. Key values must be
unique.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>original_table</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Result of a datajoint .fetch() call on a schema query.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>new_values</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of tuples, each containing (key_value, replace_value).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>replace_column</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the column where to-be-replaced values are located.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>original_table</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Structured array of new table entries that can be inserted back into the schema</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/utils/dj_helper_fn.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dj_replace</span><span class="p">(</span><span class="n">original_table</span><span class="p">,</span> <span class="n">new_values</span><span class="p">,</span> <span class="n">key_column</span><span class="p">,</span> <span class="n">replace_column</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given the output of a fetch() call from a schema and a 2D array made up</span>
<span class="sd">    of (key_value, replace_value) tuples, find each instance of key_value in</span>
<span class="sd">    the key_column of the original table and replace the specified</span>
<span class="sd">    replace_column with the associated replace_value. Key values must be</span>
<span class="sd">    unique.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original_table</span>
<span class="sd">        Result of a datajoint .fetch() call on a schema query.</span>
<span class="sd">    new_values : list</span>
<span class="sd">        List of tuples, each containing (key_value, replace_value).</span>
<span class="sd">    replace_column : str</span>
<span class="sd">        The name of the column where to-be-replaced values are located.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    original_table</span>
<span class="sd">        Structured array of new table entries that can be inserted back into the schema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check to make sure the new_values are a list or array of tuples and fix if not</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_values</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_values</span><span class="p">)</span>
        <span class="n">new_values</span> <span class="o">=</span> <span class="n">tmp</span>

    <span class="n">new_val_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_values</span><span class="p">)</span>
    <span class="n">replace_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">original_table</span><span class="p">[</span><span class="n">key_column</span><span class="p">],</span> <span class="n">new_val_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="n">original_table</span><span class="p">[</span><span class="n">replace_column</span><span class="p">][</span><span class="n">replace_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_val_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">original_table</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.IntervalList" class="doc doc-heading">
        <code>IntervalList</code>


<a href="#src.spyglass.spikesorting.spikesorting_recording.IntervalList" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/common/common_interval.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">IntervalList</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # Time intervals used for analysis</span>
<span class="s2">    -&gt; Session</span>
<span class="s2">    interval_list_name: varchar(200)  # descriptive name of this interval list</span>
<span class="s2">    ---</span>
<span class="s2">    valid_times: longblob  # numpy array with start and end times for each interval</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert_from_nwbfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add each entry in the NWB file epochs table to the IntervalList table.</span>

<span class="sd">        The interval list name for each epoch is set to the first tag for the epoch.</span>
<span class="sd">        If the epoch has no tags, then &#39;interval_x&#39; will be used as the interval list name, where x is the index</span>
<span class="sd">        (0-indexed) of the epoch in the epochs table.</span>
<span class="sd">        The start time and stop time of the epoch are stored in the valid_times field as a numpy array of</span>
<span class="sd">        [start time, stop time] for each epoch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwbf : pynwb.NWBFile</span>
<span class="sd">            The source NWB file object.</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The file name of the NWB file, used as a primary key to the Session table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No epochs found in NWB file.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">epochs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">epoch_index</span><span class="p">,</span> <span class="n">epoch_data</span> <span class="ow">in</span> <span class="n">epochs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">epoch_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
            <span class="k">if</span> <span class="n">epoch_data</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;interval_list_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch_data</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;interval_list_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;interval_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">epoch_index</span>
                <span class="p">)</span>
            <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;valid_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">epoch_data</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">epoch_data</span><span class="o">.</span><span class="n">stop_time</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">epoch_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
        <span class="n">interval_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">interval_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">interval_list</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">valid_times</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="p">[</span><span class="n">interval_count</span><span class="p">,</span> <span class="n">interval_count</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">interval</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">interval_count</span><span class="p">,</span> <span class="n">interval_count</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">interval_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">interval_list</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">interval_list</span><span class="o">.</span><span class="n">interval_list_name</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_epoch_pos_raw_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
        <span class="n">interval_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">raw_data_valid_times</span> <span class="o">=</span> <span class="n">interval_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">interval_list</span><span class="o">.</span><span class="n">interval_list_name</span> <span class="o">==</span> <span class="s2">&quot;raw data valid times&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">valid_times</span>
        <span class="n">interval_y</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">raw_data_valid_times</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="p">[</span><span class="n">interval_y</span><span class="p">,</span> <span class="n">interval_y</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="p">[</span><span class="n">interval_y</span><span class="p">,</span> <span class="n">interval_y</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">epoch_valid_times</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">interval_list</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;interval_list_name&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^[0-9]&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="o">.</span><span class="n">valid_times</span>
        <span class="p">)</span>
        <span class="n">interval_y</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">valid_times</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">epoch_valid_times</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">epoch_valid_times</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">valid_times</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="p">[</span><span class="n">interval_y</span><span class="p">,</span> <span class="n">interval_y</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">interval</span><span class="p">,</span> <span class="p">[</span><span class="n">interval_y</span><span class="p">,</span> <span class="n">interval_y</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">interval</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">interval_y</span><span class="p">,</span>
                    <span class="n">epoch</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">pos_valid_times</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">interval_list</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;interval_list_name&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^pos \d+ valid times$&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="o">.</span><span class="n">valid_times</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">index</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">index</span><span class="p">])</span>
        <span class="n">interval_y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">valid_times</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos_valid_times</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pos_valid_times</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">valid_times</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="p">[</span><span class="n">interval_y</span><span class="p">,</span> <span class="n">interval_y</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">interval</span><span class="p">,</span> <span class="p">[</span><span class="n">interval_y</span><span class="p">,</span> <span class="n">interval_y</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">interval</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">interval_y</span><span class="p">,</span>
                    <span class="n">epoch</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; valid times&quot;</span><span class="p">),</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;pos valid times&quot;</span><span class="p">,</span> <span class="s2">&quot;raw data valid times&quot;</span><span class="p">,</span> <span class="s2">&quot;epoch&quot;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_interval.IntervalList.insert_from_nwbfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert_from_nwbfile</span><span class="p">(</span><span class="n">nwbf</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_interval.IntervalList.insert_from_nwbfile" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Add each entry in the NWB file epochs table to the IntervalList table.</p>
<p>The interval list name for each epoch is set to the first tag for the epoch.
If the epoch has no tags, then 'interval_x' will be used as the interval list name, where x is the index
(0-indexed) of the epoch in the epochs table.
The start time and stop time of the epoch are stored in the valid_times field as a numpy array of
[start time, stop time] for each epoch.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwbf</code></td>
          <td>
                <code>pynwb.<span title="pynwb.NWBFile">NWBFile</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source NWB file object.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file name of the NWB file, used as a primary key to the Session table.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_interval.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">insert_from_nwbfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add each entry in the NWB file epochs table to the IntervalList table.</span>

<span class="sd">    The interval list name for each epoch is set to the first tag for the epoch.</span>
<span class="sd">    If the epoch has no tags, then &#39;interval_x&#39; will be used as the interval list name, where x is the index</span>
<span class="sd">    (0-indexed) of the epoch in the epochs table.</span>
<span class="sd">    The start time and stop time of the epoch are stored in the valid_times field as a numpy array of</span>
<span class="sd">    [start time, stop time] for each epoch.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwbf : pynwb.NWBFile</span>
<span class="sd">        The source NWB file object.</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The file name of the NWB file, used as a primary key to the Session table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No epochs found in NWB file.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">epochs</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">epoch_index</span><span class="p">,</span> <span class="n">epoch_data</span> <span class="ow">in</span> <span class="n">epochs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">epoch_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
        <span class="k">if</span> <span class="n">epoch_data</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;interval_list_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch_data</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;interval_list_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;interval_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">epoch_index</span>
            <span class="p">)</span>
        <span class="n">epoch_dict</span><span class="p">[</span><span class="s2">&quot;valid_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">epoch_data</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">epoch_data</span><span class="o">.</span><span class="n">stop_time</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">epoch_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.SortGroup" class="doc doc-heading">
        <code>SortGroup</code>


<a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/spikesorting/spikesorting_recording.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">SortGroup</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # Set of electrodes that will be sorted together</span>
<span class="s2">    -&gt; Session</span>
<span class="s2">    sort_group_id: int  # identifier for a group of electrodes</span>
<span class="s2">    ---</span>
<span class="s2">    sort_reference_electrode_id = -1: int  # the electrode to use for reference. -1: no reference, -2: common median</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">SortGroupElectrode</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; SortGroup</span>
<span class="s2">        -&gt; Electrode</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_group_by_shank</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">references</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">omit_ref_electrode_group</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">omit_unitrode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Divides electrodes into groups based on their shank position.</span>

<span class="sd">        * Electrodes from probes with 1 shank (e.g. tetrodes) are placed in a</span>
<span class="sd">          single group</span>
<span class="sd">        * Electrodes from probes with multiple shanks (e.g. polymer probes) are</span>
<span class="sd">          placed in one group per shank</span>
<span class="sd">        * Bad channels are omitted</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            the name of the NWB file whose electrodes should be put into sorting groups</span>
<span class="sd">        references : dict, optional</span>
<span class="sd">            If passed, used to set references. Otherwise, references set using</span>
<span class="sd">            original reference electrodes from config. Keys: electrode groups. Values: reference electrode.</span>
<span class="sd">        omit_ref_electrode_group : bool</span>
<span class="sd">            Optional. If True, no sort group is defined for electrode group of reference.</span>
<span class="sd">        omit_unitrode : bool</span>
<span class="sd">            Optional. If True, no sort groups are defined for unitrodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># delete any current groups</span>
        <span class="p">(</span><span class="n">SortGroup</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">})</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="c1"># get the electrodes from this NWB file</span>
        <span class="n">electrodes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Electrode</span><span class="p">()</span>
            <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
            <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;bad_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="n">e_groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]))</span>
        <span class="n">e_groups</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># sort electrode groups numerically</span>
        <span class="n">sort_group</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sg_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">sge_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
        <span class="k">for</span> <span class="n">e_group</span> <span class="ow">in</span> <span class="n">e_groups</span><span class="p">:</span>
            <span class="c1"># for each electrode group, get a list of the unique shank numbers</span>
            <span class="n">shank_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">][</span>
                    <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_group</span>
            <span class="c1"># get the indices of all electrodes in this group / shank and set their sorting group</span>
            <span class="k">for</span> <span class="n">shank</span> <span class="ow">in</span> <span class="n">shank_list</span><span class="p">:</span>
                <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group</span>
                <span class="c1"># specify reference electrode. Use &#39;references&#39; if passed, otherwise use reference from config</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">references</span><span class="p">:</span>
                    <span class="n">shank_elect_ref</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span>
                        <span class="s2">&quot;original_reference_electrode&quot;</span>
                    <span class="p">][</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                            <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span><span class="p">,</span>
                            <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">shank</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">):</span>
                        <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_elect_ref</span><span class="p">[</span>
                            <span class="mi">0</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Error in electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2">: reference electrodes are not all the same&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2"> not a key in references, so cannot set reference&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">references</span><span class="p">[</span>
                            <span class="n">e_group</span>
                        <span class="p">]</span>
                <span class="c1"># Insert sort group and sort group electrodes</span>
                <span class="n">reference_electrode_group</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span>
                    <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span>
                    <span class="o">==</span> <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span>
                <span class="p">][</span>
                    <span class="s2">&quot;electrode_group_name&quot;</span>
                <span class="p">]</span>  <span class="c1"># reference for this electrode group</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="p">):</span>  <span class="c1"># unpack single reference</span>
                    <span class="n">reference_electrode_group</span> <span class="o">=</span> <span class="n">reference_electrode_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Should have found exactly one electrode group for reference electrode,&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;but found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">omit_ref_electrode_group</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">e_group</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Omitting electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2"> from sort groups because contains reference.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">shank_elect</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">][</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                        <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span><span class="p">,</span>
                        <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">shank</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">omit_unitrode</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shank_elect</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="p">):</span>  <span class="c1"># omit unitrodes if indicated</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Omitting electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2">, shank </span><span class="si">{</span><span class="n">shank</span><span class="si">}</span><span class="s2"> from sort groups because unitrode.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sg_key</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">elect</span> <span class="ow">in</span> <span class="n">shank_elect</span><span class="p">:</span>
                    <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SortGroupElectrode</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sge_key</span><span class="p">)</span>
                <span class="n">sort_group</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">set_group_by_electrode_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign groups to all non-bad channel electrodes based on their electrode group</span>
<span class="sd">        and sets the reference for each group to the reference for the first channel of the group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name: str</span>
<span class="sd">            the name of the nwb whose electrodes should be put into sorting groups</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># delete any current groups</span>
        <span class="p">(</span><span class="n">SortGroup</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">})</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="c1"># get the electrodes from this NWB file</span>
        <span class="n">electrodes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Electrode</span><span class="p">()</span>
            <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
            <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;bad_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="n">e_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">])</span>
        <span class="n">sg_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">sge_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
        <span class="n">sort_group</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e_group</span> <span class="ow">in</span> <span class="n">e_groups</span><span class="p">:</span>
            <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_group</span>
            <span class="c1"># sg_key[&#39;sort_group_id&#39;] = sge_key[&#39;sort_group_id&#39;] = sort_group</span>
            <span class="c1"># TEST</span>
            <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">e_group</span><span class="p">)</span>
            <span class="c1"># get the list of references and make sure they are all the same</span>
            <span class="n">shank_elect_ref</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;original_reference_electrode&quot;</span><span class="p">][</span>
                <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">):</span>
                <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_elect_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error in electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2">: reference electrodes are not all the same&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sg_key</span><span class="p">)</span>

            <span class="n">shank_elect</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">][</span>
                <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">elect</span> <span class="ow">in</span> <span class="n">shank_elect</span><span class="p">:</span>
                <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SortGroupElectrode</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sge_key</span><span class="p">)</span>
            <span class="n">sort_group</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">set_reference_from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">sort_group_ref_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the reference electrode from a list containing sort groups and reference electrodes</span>
<span class="sd">        :param: sort_group_ref_list - 2D array or list where each row is [sort_group_id reference_electrode]</span>
<span class="sd">        :param: nwb_file_name - The name of the NWB file whose electrodes&#39; references should be updated</span>
<span class="sd">        :return: Null</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
        <span class="n">sort_group_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">SortGroup</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sort_group</span> <span class="ow">in</span> <span class="n">sort_group_list</span><span class="p">:</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">dj_replace</span><span class="p">(</span>
                    <span class="n">sort_group_list</span><span class="p">,</span>
                    <span class="n">sort_group_ref_list</span><span class="p">,</span>
                    <span class="s2">&quot;sort_group_id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">replace</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort_group_id</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list with the x,y coordinates of the electrodes in the sort group</span>
<span class="sd">        for use with the SpikeInterface package.</span>

<span class="sd">        Converts z locations to y where appropriate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sort_group_id : int</span>
<span class="sd">        nwb_file_name : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        geometry : list</span>
<span class="sd">            List of coordinate pairs, one per electrode</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create the channel_groups dictiorary</span>
        <span class="n">channel_group</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
        <span class="n">electrodes</span> <span class="o">=</span> <span class="p">(</span><span class="n">Electrode</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>

        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group_id</span>
        <span class="n">sort_group_electrodes</span> <span class="o">=</span> <span class="p">(</span><span class="n">SortGroup</span><span class="o">.</span><span class="n">SortGroupElectrode</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="n">electrode_group_name</span> <span class="o">=</span> <span class="n">sort_group_electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">probe_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ElectrodeGroup</span>
            <span class="o">&amp;</span> <span class="p">{</span>
                <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">,</span>
                <span class="s2">&quot;electrode_group_name&quot;</span><span class="p">:</span> <span class="n">electrode_group_name</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;probe_id&quot;</span><span class="p">)</span>
        <span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">][</span><span class="s2">&quot;channels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group_electrodes</span><span class="p">[</span>
            <span class="s2">&quot;electrode_id&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">n_chan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">][</span><span class="s2">&quot;channels&quot;</span><span class="p">])</span>

        <span class="n">geometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_chan</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="n">tmp_geom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_chan</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">electrode_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">][</span><span class="s2">&quot;channels&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="c1"># get the relative x and y locations of this channel from the probe table</span>
            <span class="n">probe_electrode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_electrode&quot;</span><span class="p">][</span>
                    <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">electrode_id</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">rel_x</span><span class="p">,</span> <span class="n">rel_y</span><span class="p">,</span> <span class="n">rel_z</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Probe</span><span class="p">()</span><span class="o">.</span><span class="n">Electrode</span><span class="p">()</span>
                <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;probe_id&quot;</span><span class="p">:</span> <span class="n">probe_id</span><span class="p">,</span> <span class="s2">&quot;probe_electrode&quot;</span><span class="p">:</span> <span class="n">probe_electrode</span><span class="p">}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;rel_x&quot;</span><span class="p">,</span> <span class="s2">&quot;rel_y&quot;</span><span class="p">,</span> <span class="s2">&quot;rel_z&quot;</span><span class="p">)</span>
            <span class="c1"># TODO: Fix this HACK when we can use probeinterface:</span>
            <span class="n">rel_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rel_x</span><span class="p">)</span>
            <span class="n">rel_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rel_y</span><span class="p">)</span>
            <span class="n">rel_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rel_z</span><span class="p">)</span>
            <span class="n">tmp_geom</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel_x</span><span class="p">,</span> <span class="n">rel_y</span><span class="p">,</span> <span class="n">rel_z</span><span class="p">]</span>

        <span class="c1"># figure out which columns have coordinates</span>
        <span class="n">n_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tmp_geom</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">n_found</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">geometry</span><span class="p">[:,</span> <span class="n">n_found</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_geom</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">n_found</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="ne">Warning</span><span class="p">(</span>
                        <span class="s2">&quot;Relative electrode locations have three coordinates; only two are currently supported&quot;</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_group_by_shank" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_group_by_shank</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omit_ref_electrode_group</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">omit_unitrode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_group_by_shank" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Divides electrodes into groups based on their shank position.</p>
<ul>
<li>Electrodes from probes with 1 shank (e.g. tetrodes) are placed in a
  single group</li>
<li>Electrodes from probes with multiple shanks (e.g. polymer probes) are
  placed in one group per shank</li>
<li>Bad channels are omitted</li>
</ul>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the name of the NWB file whose electrodes should be put into sorting groups</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>references</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If passed, used to set references. Otherwise, references set using
original reference electrodes from config. Keys: electrode groups. Values: reference electrode.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>omit_ref_electrode_group</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional. If True, no sort group is defined for electrode group of reference.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>omit_unitrode</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional. If True, no sort groups are defined for unitrodes.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/spikesorting/spikesorting_recording.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_group_by_shank</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">references</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">omit_ref_electrode_group</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">omit_unitrode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Divides electrodes into groups based on their shank position.</span>

<span class="sd">    * Electrodes from probes with 1 shank (e.g. tetrodes) are placed in a</span>
<span class="sd">      single group</span>
<span class="sd">    * Electrodes from probes with multiple shanks (e.g. polymer probes) are</span>
<span class="sd">      placed in one group per shank</span>
<span class="sd">    * Bad channels are omitted</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        the name of the NWB file whose electrodes should be put into sorting groups</span>
<span class="sd">    references : dict, optional</span>
<span class="sd">        If passed, used to set references. Otherwise, references set using</span>
<span class="sd">        original reference electrodes from config. Keys: electrode groups. Values: reference electrode.</span>
<span class="sd">    omit_ref_electrode_group : bool</span>
<span class="sd">        Optional. If True, no sort group is defined for electrode group of reference.</span>
<span class="sd">    omit_unitrode : bool</span>
<span class="sd">        Optional. If True, no sort groups are defined for unitrodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># delete any current groups</span>
    <span class="p">(</span><span class="n">SortGroup</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">})</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="c1"># get the electrodes from this NWB file</span>
    <span class="n">electrodes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Electrode</span><span class="p">()</span>
        <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
        <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;bad_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="n">e_groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]))</span>
    <span class="n">e_groups</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># sort electrode groups numerically</span>
    <span class="n">sort_group</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sg_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sge_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
    <span class="k">for</span> <span class="n">e_group</span> <span class="ow">in</span> <span class="n">e_groups</span><span class="p">:</span>
        <span class="c1"># for each electrode group, get a list of the unique shank numbers</span>
        <span class="n">shank_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">][</span>
                <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_group</span>
        <span class="c1"># get the indices of all electrodes in this group / shank and set their sorting group</span>
        <span class="k">for</span> <span class="n">shank</span> <span class="ow">in</span> <span class="n">shank_list</span><span class="p">:</span>
            <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group</span>
            <span class="c1"># specify reference electrode. Use &#39;references&#39; if passed, otherwise use reference from config</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">references</span><span class="p">:</span>
                <span class="n">shank_elect_ref</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span>
                    <span class="s2">&quot;original_reference_electrode&quot;</span>
                <span class="p">][</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                        <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span><span class="p">,</span>
                        <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">shank</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">):</span>
                    <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_elect_ref</span><span class="p">[</span>
                        <span class="mi">0</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Error in electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2">: reference electrodes are not all the same&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2"> not a key in references, so cannot set reference&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">references</span><span class="p">[</span>
                        <span class="n">e_group</span>
                    <span class="p">]</span>
            <span class="c1"># Insert sort group and sort group electrodes</span>
            <span class="n">reference_electrode_group</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span>
                <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span>
                <span class="o">==</span> <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span>
            <span class="p">][</span>
                <span class="s2">&quot;electrode_group_name&quot;</span>
            <span class="p">]</span>  <span class="c1"># reference for this electrode group</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">):</span>  <span class="c1"># unpack single reference</span>
                <span class="n">reference_electrode_group</span> <span class="o">=</span> <span class="n">reference_electrode_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Should have found exactly one electrode group for reference electrode,&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">omit_ref_electrode_group</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">e_group</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">reference_electrode_group</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Omitting electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2"> from sort groups because contains reference.&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">shank_elect</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">][</span>
                <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                    <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span><span class="p">,</span>
                    <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">shank</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">omit_unitrode</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shank_elect</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">):</span>  <span class="c1"># omit unitrodes if indicated</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Omitting electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2">, shank </span><span class="si">{</span><span class="n">shank</span><span class="si">}</span><span class="s2"> from sort groups because unitrode.&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sg_key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elect</span> <span class="ow">in</span> <span class="n">shank_elect</span><span class="p">:</span>
                <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SortGroupElectrode</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sge_key</span><span class="p">)</span>
            <span class="n">sort_group</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_group_by_electrode_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_group_by_electrode_group</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_group_by_electrode_group" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Assign groups to all non-bad channel electrodes based on their electrode group
and sets the reference for each group to the reference for the first channel of the group.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the name of the nwb whose electrodes should be put into sorting groups</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/spikesorting/spikesorting_recording.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_group_by_electrode_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign groups to all non-bad channel electrodes based on their electrode group</span>
<span class="sd">    and sets the reference for each group to the reference for the first channel of the group.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name: str</span>
<span class="sd">        the name of the nwb whose electrodes should be put into sorting groups</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># delete any current groups</span>
    <span class="p">(</span><span class="n">SortGroup</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">})</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
    <span class="c1"># get the electrodes from this NWB file</span>
    <span class="n">electrodes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Electrode</span><span class="p">()</span>
        <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
        <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;bad_channel&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="n">e_groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">])</span>
    <span class="n">sg_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sge_key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
    <span class="n">sort_group</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">e_group</span> <span class="ow">in</span> <span class="n">e_groups</span><span class="p">:</span>
        <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_group</span>
        <span class="c1"># sg_key[&#39;sort_group_id&#39;] = sge_key[&#39;sort_group_id&#39;] = sort_group</span>
        <span class="c1"># TEST</span>
        <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">e_group</span><span class="p">)</span>
        <span class="c1"># get the list of references and make sure they are all the same</span>
        <span class="n">shank_elect_ref</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;original_reference_electrode&quot;</span><span class="p">][</span>
            <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shank_elect_ref</span><span class="p">):</span>
            <span class="n">sg_key</span><span class="p">[</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_elect_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error in electrode group </span><span class="si">{</span><span class="n">e_group</span><span class="si">}</span><span class="s2">: reference electrodes are not all the same&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sg_key</span><span class="p">)</span>

        <span class="n">shank_elect</span> <span class="o">=</span> <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">][</span>
            <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">e_group</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">elect</span> <span class="ow">in</span> <span class="n">shank_elect</span><span class="p">:</span>
            <span class="n">sge_key</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SortGroupElectrode</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">sge_key</span><span class="p">)</span>
        <span class="n">sort_group</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_reference_from_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_reference_from_list</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">sort_group_ref_list</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.set_reference_from_list" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Set the reference electrode from a list containing sort groups and reference electrodes
:param: sort_group_ref_list - 2D array or list where each row is [sort_group_id reference_electrode]
:param: nwb_file_name - The name of the NWB file whose electrodes' references should be updated
:return: Null</p>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/spikesorting/spikesorting_recording.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_reference_from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">sort_group_ref_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the reference electrode from a list containing sort groups and reference electrodes</span>
<span class="sd">    :param: sort_group_ref_list - 2D array or list where each row is [sort_group_id reference_electrode]</span>
<span class="sd">    :param: nwb_file_name - The name of the NWB file whose electrodes&#39; references should be updated</span>
<span class="sd">    :return: Null</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
    <span class="n">sort_group_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">SortGroup</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sort_group</span> <span class="ow">in</span> <span class="n">sort_group_list</span><span class="p">:</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="n">dj_replace</span><span class="p">(</span>
                <span class="n">sort_group_list</span><span class="p">,</span>
                <span class="n">sort_group_ref_list</span><span class="p">,</span>
                <span class="s2">&quot;sort_group_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">replace</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.spikesorting.spikesorting_recording.SortGroup.get_geometry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_geometry</span><span class="p">(</span><span class="n">sort_group_id</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.SortGroup.get_geometry" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Returns a list with the x,y coordinates of the electrodes in the sort group
for use with the SpikeInterface package.</p>
<p>Converts z locations to y where appropriate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sort_group_id</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>geometry</code></td>          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of coordinate pairs, one per electrode</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/spikesorting/spikesorting_recording.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort_group_id</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list with the x,y coordinates of the electrodes in the sort group</span>
<span class="sd">    for use with the SpikeInterface package.</span>

<span class="sd">    Converts z locations to y where appropriate.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sort_group_id : int</span>
<span class="sd">    nwb_file_name : str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    geometry : list</span>
<span class="sd">        List of coordinate pairs, one per electrode</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># create the channel_groups dictiorary</span>
    <span class="n">channel_group</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
    <span class="n">electrodes</span> <span class="o">=</span> <span class="p">(</span><span class="n">Electrode</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>

    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group_id</span>
    <span class="n">sort_group_electrodes</span> <span class="o">=</span> <span class="p">(</span><span class="n">SortGroup</span><span class="o">.</span><span class="n">SortGroupElectrode</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="n">electrode_group_name</span> <span class="o">=</span> <span class="n">sort_group_electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">probe_id</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ElectrodeGroup</span>
        <span class="o">&amp;</span> <span class="p">{</span>
            <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">,</span>
            <span class="s2">&quot;electrode_group_name&quot;</span><span class="p">:</span> <span class="n">electrode_group_name</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;probe_id&quot;</span><span class="p">)</span>
    <span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">][</span><span class="s2">&quot;channels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_group_electrodes</span><span class="p">[</span>
        <span class="s2">&quot;electrode_id&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">n_chan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">][</span><span class="s2">&quot;channels&quot;</span><span class="p">])</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_chan</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
    <span class="n">tmp_geom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_chan</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">electrode_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="n">channel_group</span><span class="p">[</span><span class="n">sort_group_id</span><span class="p">][</span><span class="s2">&quot;channels&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="c1"># get the relative x and y locations of this channel from the probe table</span>
        <span class="n">probe_electrode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;probe_electrode&quot;</span><span class="p">][</span>
                <span class="n">electrodes</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">electrode_id</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">rel_x</span><span class="p">,</span> <span class="n">rel_y</span><span class="p">,</span> <span class="n">rel_z</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Probe</span><span class="p">()</span><span class="o">.</span><span class="n">Electrode</span><span class="p">()</span>
            <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;probe_id&quot;</span><span class="p">:</span> <span class="n">probe_id</span><span class="p">,</span> <span class="s2">&quot;probe_electrode&quot;</span><span class="p">:</span> <span class="n">probe_electrode</span><span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;rel_x&quot;</span><span class="p">,</span> <span class="s2">&quot;rel_y&quot;</span><span class="p">,</span> <span class="s2">&quot;rel_z&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: Fix this HACK when we can use probeinterface:</span>
        <span class="n">rel_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rel_x</span><span class="p">)</span>
        <span class="n">rel_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rel_y</span><span class="p">)</span>
        <span class="n">rel_z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rel_z</span><span class="p">)</span>
        <span class="n">tmp_geom</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rel_x</span><span class="p">,</span> <span class="n">rel_y</span><span class="p">,</span> <span class="n">rel_z</span><span class="p">]</span>

    <span class="c1"># figure out which columns have coordinates</span>
    <span class="n">n_found</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tmp_geom</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">n_found</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">geometry</span><span class="p">[:,</span> <span class="n">n_found</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_geom</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">n_found</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">Warning</span><span class="p">(</span>
                    <span class="s2">&quot;Relative electrode locations have three coordinates; only two are currently supported&quot;</span>
                <span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">tolist</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.Nwbfile" class="doc doc-heading">
        <code>Nwbfile</code>


<a href="#src.spyglass.spikesorting.spikesorting_recording.Nwbfile" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Nwbfile</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # Table for holding the NWB files.</span>
<span class="s2">    nwb_file_name: varchar(255)   # name of the NWB file</span>
<span class="s2">    ---</span>
<span class="s2">    nwb_file_abs_path: filepath@raw</span>
<span class="s2">    INDEX (nwb_file_abs_path)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE the INDEX above is implicit from filepath@... above but needs to be explicit</span>
    <span class="c1"># so that alter() can work</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert_from_relative_file_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert a new session from an existing NWB file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The relative path to the NWB file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nwb_file_abs_path</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
            <span class="n">nwb_file_abs_path</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;File does not exist: </span><span class="si">{</span><span class="n">nwb_file_abs_path</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_abs_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_abs_path</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the absolute path for a stored raw NWB file given just the file name.</span>

<span class="sd">        The SPYGLASS_BASE_DIR environment variable must be set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The name of an NWB file that has been inserted into the Nwbfile() schema.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nwb_file_abspath : str</span>
<span class="sd">            The absolute path for the given file name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SPYGLASS_BASE_DIR&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">base_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;You must set SPYGLASS_BASE_DIR or provide the base_dir argument&quot;</span>

        <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">/</span> <span class="s2">&quot;raw&quot;</span> <span class="o">/</span> <span class="n">nwb_file_name</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_to_lock</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the specified NWB file to the file with the list of NWB files to be locked.</span>

<span class="sd">        The NWB_LOCK_FILE environment variable must be set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The name of an NWB file that has been inserted into the Nwbfile() schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
        <span class="c1"># check to make sure the file exists</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">((</span><span class="n">Nwbfile</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Error adding </span><span class="si">{</span><span class="n">nwb_file_name</span><span class="si">}</span><span class="s2"> to lock file, not in Nwbfile() schema&quot;</span>

        <span class="n">lock_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;NWB_LOCK_FILE&quot;</span><span class="p">),</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
        <span class="n">lock_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nwb_file_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lock_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">delete_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the filepath entries for NWB files that are not in use.</span>

<span class="sd">        This does not delete the files themselves unless delete_files=True is specified</span>
<span class="sd">        Run this after deleting the Nwbfile() entries themselves.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_external_files</span><span class="o">=</span><span class="n">delete_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.Nwbfile.insert_from_relative_file_name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert_from_relative_file_name</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.Nwbfile.insert_from_relative_file_name" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Insert a new session from an existing NWB file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The relative path to the NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">insert_from_relative_file_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert a new session from an existing NWB file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The relative path to the NWB file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nwb_file_abs_path</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
        <span class="n">nwb_file_abs_path</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;File does not exist: </span><span class="si">{</span><span class="n">nwb_file_abs_path</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_abs_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_abs_path</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.Nwbfile.get_abs_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.Nwbfile.get_abs_path" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Return the absolute path for a stored raw NWB file given just the file name.</p>
<p>The SPYGLASS_BASE_DIR environment variable must be set.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of an NWB file that has been inserted into the Nwbfile() schema.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>nwb_file_abspath</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The absolute path for the given file name.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the absolute path for a stored raw NWB file given just the file name.</span>

<span class="sd">    The SPYGLASS_BASE_DIR environment variable must be set.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The name of an NWB file that has been inserted into the Nwbfile() schema.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nwb_file_abspath : str</span>
<span class="sd">        The absolute path for the given file name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SPYGLASS_BASE_DIR&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">base_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">),</span> <span class="s2">&quot;You must set SPYGLASS_BASE_DIR or provide the base_dir argument&quot;</span>

    <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">base_dir</span> <span class="o">/</span> <span class="s2">&quot;raw&quot;</span> <span class="o">/</span> <span class="n">nwb_file_name</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.Nwbfile.add_to_lock" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_to_lock</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.Nwbfile.add_to_lock" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Add the specified NWB file to the file with the list of NWB files to be locked.</p>
<p>The NWB_LOCK_FILE environment variable must be set.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of an NWB file that has been inserted into the Nwbfile() schema.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">add_to_lock</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add the specified NWB file to the file with the list of NWB files to be locked.</span>

<span class="sd">    The NWB_LOCK_FILE environment variable must be set.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The name of an NWB file that has been inserted into the Nwbfile() schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
    <span class="c1"># check to make sure the file exists</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">((</span><span class="n">Nwbfile</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Error adding </span><span class="si">{</span><span class="n">nwb_file_name</span><span class="si">}</span><span class="s2"> to lock file, not in Nwbfile() schema&quot;</span>

    <span class="n">lock_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;NWB_LOCK_FILE&quot;</span><span class="p">),</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
    <span class="n">lock_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nwb_file_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">lock_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.Nwbfile.cleanup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cleanup</span><span class="p">(</span><span class="n">delete_files</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.Nwbfile.cleanup" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Remove the filepath entries for NWB files that are not in use.</p>
<p>This does not delete the files themselves unless delete_files=True is specified
Run this after deleting the Nwbfile() entries themselves.</p>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">delete_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the filepath entries for NWB files that are not in use.</span>

<span class="sd">    This does not delete the files themselves unless delete_files=True is specified</span>
<span class="sd">    Run this after deleting the Nwbfile() entries themselves.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_external_files</span><span class="o">=</span><span class="n">delete_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.LabTeam" class="doc doc-heading">
        <code>LabTeam</code>


<a href="#src.spyglass.spikesorting.spikesorting_recording.LabTeam" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/common/common_lab.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">LabTeam</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    team_name: varchar(80)</span>
<span class="s2">    ---</span>
<span class="s2">    team_description = &quot;&quot;: varchar(2000)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">LabTeamMember</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; LabTeam</span>
<span class="s2">        -&gt; LabMember</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_new_team</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">team_members</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">team_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new team with a list of team members.</span>

<span class="sd">        If the lab member does not exist in the database, they will be added.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        team_name : str</span>
<span class="sd">            The name of the team.</span>
<span class="sd">        team_members : str</span>
<span class="sd">            The full names of the lab members that are part of the team.</span>
<span class="sd">        team_description: str</span>
<span class="sd">            The description of the team.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labteam_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">labteam_dict</span><span class="p">[</span><span class="s2">&quot;team_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
        <span class="n">labteam_dict</span><span class="p">[</span><span class="s2">&quot;team_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_description</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">labteam_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">team_member</span> <span class="ow">in</span> <span class="n">team_members</span><span class="p">:</span>
            <span class="n">LabMember</span><span class="o">.</span><span class="n">insert_from_name</span><span class="p">(</span><span class="n">team_member</span><span class="p">)</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">LabMember</span><span class="o">.</span><span class="n">LabMemberInfo</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;lab_member_name&quot;</span><span class="p">:</span> <span class="n">team_member</span><span class="p">}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;google_user_name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Please add the Google user ID for </span><span class="si">{</span><span class="n">team_member</span><span class="si">}</span><span class="s2"> in the LabMember.LabMemberInfo table &quot;</span>
                    <span class="s2">&quot;if you want to give them permission to manually curate sorting by this team.&quot;</span>
                <span class="p">)</span>
            <span class="n">labteammember_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">labteammember_dict</span><span class="p">[</span><span class="s2">&quot;team_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
            <span class="n">labteammember_dict</span><span class="p">[</span><span class="s2">&quot;lab_member_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_member</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">LabTeamMember</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">labteammember_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_lab.LabTeam.create_new_team" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_new_team</span><span class="p">(</span><span class="n">team_name</span><span class="p">,</span> <span class="n">team_members</span><span class="p">,</span> <span class="n">team_description</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_lab.LabTeam.create_new_team" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Create a new team with a list of team members.</p>
<p>If the lab member does not exist in the database, they will be added.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>team_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the team.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>team_members</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The full names of the lab members that are part of the team.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>team_description</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The description of the team.</p>
            </div>
          </td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_lab.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create_new_team</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">team_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">team_members</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">team_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new team with a list of team members.</span>

<span class="sd">    If the lab member does not exist in the database, they will be added.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    team_name : str</span>
<span class="sd">        The name of the team.</span>
<span class="sd">    team_members : str</span>
<span class="sd">        The full names of the lab members that are part of the team.</span>
<span class="sd">    team_description: str</span>
<span class="sd">        The description of the team.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labteam_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">labteam_dict</span><span class="p">[</span><span class="s2">&quot;team_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
    <span class="n">labteam_dict</span><span class="p">[</span><span class="s2">&quot;team_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_description</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">labteam_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">team_member</span> <span class="ow">in</span> <span class="n">team_members</span><span class="p">:</span>
        <span class="n">LabMember</span><span class="o">.</span><span class="n">insert_from_name</span><span class="p">(</span><span class="n">team_member</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">LabMember</span><span class="o">.</span><span class="n">LabMemberInfo</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;lab_member_name&quot;</span><span class="p">:</span> <span class="n">team_member</span><span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;google_user_name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Please add the Google user ID for </span><span class="si">{</span><span class="n">team_member</span><span class="si">}</span><span class="s2"> in the LabMember.LabMemberInfo table &quot;</span>
                <span class="s2">&quot;if you want to give them permission to manually curate sorting by this team.&quot;</span>
            <span class="p">)</span>
        <span class="n">labteammember_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">labteammember_dict</span><span class="p">[</span><span class="s2">&quot;team_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_name</span>
        <span class="n">labteammember_dict</span><span class="p">[</span><span class="s2">&quot;lab_member_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_member</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">LabTeamMember</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">labteammember_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.Electrode" class="doc doc-heading">
        <code>Electrode</code>


<a href="#src.spyglass.spikesorting.spikesorting_recording.Electrode" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Imported">Imported</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/common/common_ephys.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Electrode</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Imported</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; ElectrodeGroup</span>
<span class="s2">    electrode_id: int                      # the unique number for this electrode</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; [nullable] Probe.Electrode</span>
<span class="s2">    -&gt; BrainRegion</span>
<span class="s2">    name = &quot;&quot;: varchar(200)                 # unique label for each contact</span>
<span class="s2">    original_reference_electrode = -1: int  # the configured reference electrode for this electrode</span>
<span class="s2">    x = NULL: float                         # the x coordinate of the electrode position in the brain</span>
<span class="s2">    y = NULL: float                         # the y coordinate of the electrode position in the brain</span>
<span class="s2">    z = NULL: float                         # the z coordinate of the electrode position in the brain</span>
<span class="s2">    filtering: varchar(2000)                # description of the signal filtering</span>
<span class="s2">    impedance = NULL: float                 # electrode impedance</span>
<span class="s2">    bad_channel = &quot;False&quot;: enum(&quot;True&quot;, &quot;False&quot;)  # if electrode is &quot;good&quot; or &quot;bad&quot; as observed during recording</span>
<span class="s2">    x_warped = NULL: float                  # x coordinate of electrode position warped to common template brain</span>
<span class="s2">    y_warped = NULL: float                  # y coordinate of electrode position warped to common template brain</span>
<span class="s2">    z_warped = NULL: float                  # z coordinate of electrode position warped to common template brain</span>
<span class="s2">    contacts: varchar(200)                  # label of electrode contacts used for a bipolar signal - current workaround</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">nwb_file_name</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span>
        <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;Electrode&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">electrode_config_dicts</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">electrode_dict</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]:</span> <span class="n">electrode_dict</span>
                <span class="k">for</span> <span class="n">electrode_dict</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">electrode_config_dicts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">electrodes</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">electrodes</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">elect_id</span><span class="p">,</span> <span class="n">elect_data</span> <span class="ow">in</span> <span class="n">electrodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_id</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">elect_id</span><span class="p">)</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">group_name</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;region_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BrainRegion</span><span class="o">.</span><span class="n">fetch_add</span><span class="p">(</span>
                <span class="n">region_name</span><span class="o">=</span><span class="n">elect_data</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">location</span>
            <span class="p">)</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">x</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">y</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">z</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;x_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;y_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;z_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;contacts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;filtering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">filtering</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;impedance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;imp&quot;</span><span class="p">)</span>

            <span class="c1"># rough check of whether the electrodes table was created by rec_to_nwb and has</span>
            <span class="c1"># the appropriate custom columns used by rec_to_nwb</span>
            <span class="c1"># TODO this could be better resolved by making an extension for the electrodes table</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">elect_data</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">ndx_franklab_novela</span><span class="o">.</span><span class="n">Probe</span><span class="p">)</span>
                <span class="ow">and</span> <span class="s2">&quot;probe_shank&quot;</span> <span class="ow">in</span> <span class="n">elect_data</span>
                <span class="ow">and</span> <span class="s2">&quot;probe_electrode&quot;</span> <span class="ow">in</span> <span class="n">elect_data</span>
                <span class="ow">and</span> <span class="s2">&quot;bad_channel&quot;</span> <span class="ow">in</span> <span class="n">elect_data</span>
                <span class="ow">and</span> <span class="s2">&quot;ref_elect_id&quot;</span> <span class="ow">in</span> <span class="n">elect_data</span>
            <span class="p">):</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">probe_type</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">probe_shank</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;probe_electrode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">probe_electrode</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;bad_channel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">bad_channel</span> <span class="k">else</span> <span class="s2">&quot;False&quot;</span>
                <span class="p">)</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;original_reference_electrode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">ref_elect_id</span>

            <span class="c1"># override with information from the config YAML based on primary key (electrode id)</span>
            <span class="k">if</span> <span class="n">elect_id</span> <span class="ow">in</span> <span class="n">electrode_config_dicts</span><span class="p">:</span>
                <span class="c1"># check whether the Probe.Electrode being referenced exists</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">Probe</span><span class="o">.</span><span class="n">Electrode</span> <span class="o">&amp;</span> <span class="n">electrode_config_dicts</span><span class="p">[</span><span class="n">elect_id</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No Probe.Electrode exists that matches the data: </span><span class="si">{</span><span class="n">electrode_config_dicts</span><span class="p">[</span><span class="n">elect_id</span><span class="p">]</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;The config YAML for Electrode with electrode_id </span><span class="si">{</span><span class="n">elect_id</span><span class="si">}</span><span class="s2"> will be ignored.&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">electrode_config_dicts</span><span class="p">[</span><span class="n">elect_id</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create or update Electrode entries from what is specified in the config YAML file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The name of the NWB file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Electrode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># map electrode id to dictionary of electrode information from config YAML</span>
        <span class="n">electrode_dicts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">electrode_dict</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]:</span> <span class="n">electrode_dict</span>
            <span class="k">for</span> <span class="n">electrode_dict</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">electrodes</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">electrodes</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nwbfile_elect_id</span><span class="p">,</span> <span class="n">elect_data</span> <span class="ow">in</span> <span class="n">electrodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">nwbfile_elect_id</span> <span class="ow">in</span> <span class="n">electrode_dicts</span><span class="p">:</span>
                <span class="c1"># use the information in the electrodes table to start and then add (or overwrite) values from the</span>
                <span class="c1"># config YAML</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nwbfile_elect_id</span><span class="p">)</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">group_name</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;region_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BrainRegion</span><span class="o">.</span><span class="n">fetch_add</span><span class="p">(</span>
                    <span class="n">region_name</span><span class="o">=</span><span class="n">elect_data</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">location</span>
                <span class="p">)</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">x</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">y</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">z</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;x_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;y_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;z_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;contacts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;filtering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">filtering</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;impedance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;imp&quot;</span><span class="p">)</span>
                <span class="n">key</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">electrode_dicts</span><span class="p">[</span><span class="n">nwbfile_elect_id</span><span class="p">])</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">Electrode</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">:</span> <span class="n">nwbfile_elect_id</span><span class="p">}</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">update1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Electrode with ID </span><span class="si">{</span><span class="n">nwbfile_elect_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserted Electrode with ID </span><span class="si">{</span><span class="n">nwbfile_elect_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Electrode ID </span><span class="si">{</span><span class="n">nwbfile_elect_id</span><span class="si">}</span><span class="s2"> exists in the NWB file but has no corresponding &quot;</span>
                    <span class="s2">&quot;config YAML entry.&quot;</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_ephys.Electrode.create_from_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_from_config</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_ephys.Electrode.create_from_config" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Create or update Electrode entries from what is specified in the config YAML file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_ephys.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create_from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create or update Electrode entries from what is specified in the config YAML file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The name of the NWB file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
    <span class="n">nwbf</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Electrode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># map electrode id to dictionary of electrode information from config YAML</span>
    <span class="n">electrode_dicts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">electrode_dict</span><span class="p">[</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">]:</span> <span class="n">electrode_dict</span>
        <span class="k">for</span> <span class="n">electrode_dict</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">electrodes</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">electrodes</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nwbfile_elect_id</span><span class="p">,</span> <span class="n">elect_data</span> <span class="ow">in</span> <span class="n">electrodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">nwbfile_elect_id</span> <span class="ow">in</span> <span class="n">electrode_dicts</span><span class="p">:</span>
            <span class="c1"># use the information in the electrodes table to start and then add (or overwrite) values from the</span>
            <span class="c1"># config YAML</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nwbfile_elect_id</span><span class="p">)</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">group_name</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;region_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BrainRegion</span><span class="o">.</span><span class="n">fetch_add</span><span class="p">(</span>
                <span class="n">region_name</span><span class="o">=</span><span class="n">elect_data</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">location</span>
            <span class="p">)</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">x</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">y</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">z</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;x_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;y_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;z_warped&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;contacts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;filtering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">filtering</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;impedance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elect_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;imp&quot;</span><span class="p">)</span>
            <span class="n">key</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">electrode_dicts</span><span class="p">[</span><span class="n">nwbfile_elect_id</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">Electrode</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">:</span> <span class="n">nwbfile_elect_id</span><span class="p">}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">update1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated Electrode with ID </span><span class="si">{</span><span class="n">nwbfile_elect_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_direct_insert</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserted Electrode with ID </span><span class="si">{</span><span class="n">nwbfile_elect_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Electrode ID </span><span class="si">{</span><span class="n">nwbfile_elect_id</span><span class="si">}</span><span class="s2"> exists in the NWB file but has no corresponding &quot;</span>
                <span class="s2">&quot;config YAML entry.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.intervals_by_length" class="doc doc-heading">
<code class="highlight language-python"><span class="n">intervals_by_length</span><span class="p">(</span><span class="n">interval_list</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mf">10000000000.0</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.intervals_by_length" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Select intervals of certain lengths from an interval list.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>interval_list</code></td>
          <td>
                <code>array_like</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Each element is (start time, stop time), i.e. an interval. Unit is seconds.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_length</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum interval length in seconds. Defaults to 0.0.</p>
            </div>
          </td>
          <td>
                <code>0.0</code>
          </td>
        </tr>
        <tr>
          <td><code>max_length</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum interval length in seconds. Defaults to 1e10.</p>
            </div>
          </td>
          <td>
                <code>10000000000.0</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_interval.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">intervals_by_length</span><span class="p">(</span><span class="n">interval_list</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mf">1e10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select intervals of certain lengths from an interval list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    interval_list : array_like</span>
<span class="sd">        Each element is (start time, stop time), i.e. an interval. Unit is seconds.</span>
<span class="sd">    min_length : float, optional</span>
<span class="sd">        Minimum interval length in seconds. Defaults to 0.0.</span>
<span class="sd">    max_length : float, optional</span>
<span class="sd">        Maximum interval length in seconds. Defaults to 1e10.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">interval_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">interval_list</span><span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">lengths</span> <span class="o">&gt;</span> <span class="n">min_length</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">&lt;</span> <span class="n">max_length</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.interval_list_intersect" class="doc doc-heading">
<code class="highlight language-python"><span class="n">interval_list_intersect</span><span class="p">(</span><span class="n">interval_list1</span><span class="p">,</span> <span class="n">interval_list2</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.interval_list_intersect" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Finds the intersections between two interval lists</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>interval_list1</code></td>
          <td>
                <code>np.array, (N,2) where N = number of intervals</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>interval_list2</code></td>
          <td>
                <code>np.array, (N,2) where N = number of intervals</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>min_length</code></td>
          <td>
                <code>float, optional.</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum length of intervals to include, default 0</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Each interval is (start time, stop time)</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>interval_list</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span>, N, 2</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_interval.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interval_list_intersect</span><span class="p">(</span><span class="n">interval_list1</span><span class="p">,</span> <span class="n">interval_list2</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds the intersections between two interval lists</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    interval_list1 : np.array, (N,2) where N = number of intervals</span>
<span class="sd">    interval_list2 : np.array, (N,2) where N = number of intervals</span>
<span class="sd">    min_length : float, optional.</span>
<span class="sd">        Minimum length of intervals to include, default 0</span>

<span class="sd">    Each interval is (start time, stop time)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    interval_list: np.array, (N,2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># first, consolidate interval lists to disjoint intervals by sorting and applying union</span>
    <span class="k">if</span> <span class="n">interval_list1</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interval_list1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">interval_list1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interval_list1</span> <span class="o">=</span> <span class="n">interval_list1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">interval_list1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])]</span>
        <span class="n">interval_list1</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_union_concat</span><span class="p">,</span> <span class="n">interval_list1</span><span class="p">)</span>
        <span class="c1"># the following check is needed in the case where the interval list is a single element (behavior of reduce)</span>
        <span class="k">if</span> <span class="n">interval_list1</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">interval_list1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">interval_list1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">interval_list2</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interval_list2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">interval_list2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interval_list2</span> <span class="o">=</span> <span class="n">interval_list2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">interval_list2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])]</span>
        <span class="n">interval_list2</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_union_concat</span><span class="p">,</span> <span class="n">interval_list2</span><span class="p">)</span>
        <span class="c1"># the following check is needed in the case where the interval list is a single element (behavior of reduce)</span>
        <span class="k">if</span> <span class="n">interval_list2</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">interval_list2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">interval_list2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># then do pairwise comparison and collect intersections</span>
    <span class="n">intersecting_intervals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">interval2</span> <span class="ow">in</span> <span class="n">interval_list2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">interval1</span> <span class="ow">in</span> <span class="n">interval_list1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_intersection</span><span class="p">(</span><span class="n">interval2</span><span class="p">,</span> <span class="n">interval1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">intersecting_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">_intersection</span><span class="p">(</span><span class="n">interval1</span><span class="p">,</span> <span class="n">interval2</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># if no intersection, then return an empty list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">intersecting_intervals</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">intersecting_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">intersecting_intervals</span><span class="p">)</span>
        <span class="n">intersecting_intervals</span> <span class="o">=</span> <span class="n">intersecting_intervals</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">intersecting_intervals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">intervals_by_length</span><span class="p">(</span>
            <span class="n">intersecting_intervals</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="n">min_length</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.Probe" class="doc doc-heading">
        <code>Probe</code>


<a href="#src.spyglass.spikesorting.spikesorting_recording.Probe" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/common/common_device.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Probe</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # A configuration of a ProbeType. For most probe types, there is only one configuration, and that configuration</span>
<span class="s2">    # should always be used. For Neuropixels probes, the specific channel map (which electrodes are used,</span>
<span class="s2">    # where are they, and in what order) can differ between users and sessions, and each configuration should have a</span>
<span class="s2">    # different ProbeType.</span>
<span class="s2">    probe_id: varchar(80)     # a unique ID for this probe and dynamic configuration</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; ProbeType              # the type of probe, selected from a controlled list of probe types</span>
<span class="s2">    -&gt; [nullable] DataAcquisitionDevice  # the data acquisition device used with this Probe</span>
<span class="s2">    contact_side_numbering: enum(&quot;True&quot;, &quot;False&quot;)  # if True, then electrode contacts are facing you when numbering them</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Shank</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; Probe</span>
<span class="s2">        probe_shank: int              # shank number within probe. should be unique within a Probe</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Electrode</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; Probe.Shank</span>
<span class="s2">        probe_electrode: int          # electrode ID that is output from the data acquisition system</span>
<span class="s2">                                      # probe_electrode should be unique within a Probe</span>
<span class="s2">        ---</span>
<span class="s2">        contact_size = NULL: float    # (um) contact size</span>
<span class="s2">        rel_x = NULL: float           # (um) x coordinate of the electrode within the probe</span>
<span class="s2">        rel_y = NULL: float           # (um) y coordinate of the electrode within the probe</span>
<span class="s2">        rel_z = NULL: float           # (um) z coordinate of the electrode within the probe</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert_from_nwbfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert probe devices from an NWB file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwbf : pynwb.NWBFile</span>
<span class="sd">            The source NWB file object.</span>
<span class="sd">        config : dict</span>
<span class="sd">            Dictionary read from a user-defined YAML file containing values to replace in the NWB file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        device_name_list : list</span>
<span class="sd">            List of probe device types found in the NWB file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_probes_types</span><span class="p">,</span> <span class="n">ndx_probes</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_all_probe_names</span><span class="p">(</span><span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">probe_type</span> <span class="ow">in</span> <span class="n">all_probes_types</span><span class="p">:</span>
            <span class="n">new_probe_type_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">new_probe_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">shank_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">elect_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">num_shanks</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">probe_type</span> <span class="ow">in</span> <span class="n">ndx_probes</span><span class="p">:</span>
                <span class="c1"># read probe properties into new_probe_dict from PyNWB extension probe object</span>
                <span class="n">nwb_probe_obj</span> <span class="o">=</span> <span class="n">ndx_probes</span><span class="p">[</span><span class="n">probe_type</span><span class="p">]</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">__read_ndx_probe_data</span><span class="p">(</span>
                    <span class="n">nwb_probe_obj</span><span class="p">,</span>
                    <span class="n">new_probe_type_dict</span><span class="p">,</span>
                    <span class="n">new_probe_dict</span><span class="p">,</span>
                    <span class="n">shank_dict</span><span class="p">,</span>
                    <span class="n">elect_dict</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># check that number of shanks is consistent</span>
            <span class="n">num_shanks</span> <span class="o">=</span> <span class="n">new_probe_type_dict</span><span class="p">[</span><span class="s2">&quot;num_shanks&quot;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">num_shanks</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">num_shanks</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">shank_dict</span>
            <span class="p">),</span> <span class="s2">&quot;`num_shanks` is not equal to the number of shanks.&quot;</span>

            <span class="c1"># if probe id already exists, do not overwrite anything or create new Shanks and Electrodes</span>
            <span class="c1"># TODO test whether the Shanks and Electrodes in the NWB file match the ones in the database</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">Probe</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;probe_id&quot;</span><span class="p">:</span> <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Probe ID &#39;</span><span class="si">{</span><span class="n">new_probe_dict</span><span class="p">[</span><span class="s1">&#39;probe_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; already exists in the database. Spyglass will use &quot;</span>
                    <span class="s2">&quot;that and not create a new Probe, Shanks, or Electrodes.&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">new_probe_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">shank</span> <span class="ow">in</span> <span class="n">shank_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">Shank</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">shank</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">elect_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">Electrode</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">electrode</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">all_probes_types</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserted probes </span><span class="si">{</span><span class="n">all_probes_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No conforming probe metadata found.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_probes_types</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_all_probe_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of all device names in the NWB file, after appending and overwriting by the config file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwbf : pynwb.NWBFile</span>
<span class="sd">            The source NWB file object.</span>
<span class="sd">        config : dict</span>
<span class="sd">            Dictionary read from a user-defined YAML file containing values to replace in the NWB file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        device_name_list : list</span>
<span class="sd">            List of data acquisition object names found in the NWB file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make a dict mapping probe type to PyNWB object for all devices in the NWB file that are</span>
        <span class="c1"># of type ndx_franklab_novela.Probe and thus have the required metadata</span>
        <span class="n">ndx_probes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">device_obj</span><span class="o">.</span><span class="n">probe_type</span><span class="p">:</span> <span class="n">device_obj</span>
            <span class="k">for</span> <span class="n">device_obj</span> <span class="ow">in</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device_obj</span><span class="p">,</span> <span class="n">ndx_franklab_novela</span><span class="o">.</span><span class="n">Probe</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># make a dict mapping probe type to dict of device metadata from the config YAML if exists</span>
        <span class="k">if</span> <span class="s2">&quot;Probe&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">config_probes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">probe_dict</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;Probe&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config_probes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># get all the probe types from the NWB file plus the config YAML</span>
        <span class="n">all_probes_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ndx_probes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">config_probes</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">all_probes_types</span><span class="p">,</span> <span class="n">ndx_probes</span><span class="p">,</span> <span class="n">config_probes</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__read_ndx_probe_data</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">nwb_probe_obj</span><span class="p">:</span> <span class="n">ndx_franklab_novela</span><span class="o">.</span><span class="n">Probe</span><span class="p">,</span>
        <span class="n">new_probe_type_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">new_probe_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">shank_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">elect_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># construct dictionary of values to add to ProbeType</span>
        <span class="n">new_probe_type_dict</span><span class="p">[</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">nwb_probe_obj</span><span class="p">,</span> <span class="s2">&quot;manufacturer&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">new_probe_type_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">probe_type</span>
        <span class="n">new_probe_type_dict</span><span class="p">[</span>
            <span class="s2">&quot;probe_description&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">probe_description</span>
        <span class="n">new_probe_type_dict</span><span class="p">[</span><span class="s2">&quot;num_shanks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">shanks</span><span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_add_probe_type</span><span class="p">(</span><span class="n">new_probe_type_dict</span><span class="p">)</span>

        <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">probe_type</span>
        <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">probe_type</span>
        <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;contact_side_numbering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">contact_side_numbering</span> <span class="k">else</span> <span class="s2">&quot;False&quot;</span>
        <span class="p">)</span>

        <span class="c1"># go through the shanks and add each one to the Shank table</span>
        <span class="k">for</span> <span class="n">shank</span> <span class="ow">in</span> <span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">shanks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span>
            <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shank</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="c1"># go through the electrodes and add each one to the Electrode table</span>
            <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">shank</span><span class="o">.</span><span class="n">shanks_electrodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="c1"># the next line will need to be fixed if we have different sized contacts on a shank</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_probe_dict</span><span class="p">[</span>
                    <span class="s2">&quot;probe_type&quot;</span>
                <span class="p">]</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_dict</span><span class="p">[</span>
                    <span class="n">shank</span><span class="o">.</span><span class="n">name</span>
                <span class="p">][</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">][</span>
                    <span class="s2">&quot;contact_size&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">nwb_probe_obj</span><span class="o">.</span><span class="n">contact_size</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;probe_electrode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">electrode</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;rel_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">electrode</span><span class="o">.</span><span class="n">rel_x</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;rel_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">electrode</span><span class="o">.</span><span class="n">rel_y</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">electrode</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;rel_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">electrode</span><span class="o">.</span><span class="n">rel_z</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_add_probe_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_probe_type_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the probe type value against the values in the database.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_probe_type_dict : dict</span>
<span class="sd">            Dictionary of probe type properties. See ProbeType for keys.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        PopulateException</span>
<span class="sd">            If user chooses not to add a probe type to the database when prompted.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        probe_type : str</span>
<span class="sd">            The probe type value that was added to the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">probe_type</span> <span class="o">=</span> <span class="n">new_probe_type_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span>
        <span class="n">all_values</span> <span class="o">=</span> <span class="n">ProbeType</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;probe_type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">probe_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Probe type &#39;</span><span class="si">{</span><span class="n">probe_type</span><span class="si">}</span><span class="s2">&#39; was not found in the database. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The current values are: </span><span class="si">{</span><span class="n">all_values</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Please ensure that the probe type you want to add does not already &quot;</span>
                <span class="s2">&quot;exist in the database under a different name or spelling. &quot;</span>
                <span class="s2">&quot;If you want to use an existing name in the database, &quot;</span>
                <span class="s2">&quot;please change the corresponding Probe object in the NWB file. &quot;</span>
                <span class="s2">&quot;Entering &#39;N&#39; will raise an exception.&quot;</span>
            <span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Do you want to add probe type &#39;</span><span class="si">{</span><span class="n">probe_type</span><span class="si">}</span><span class="s2">&#39; to the database? (y/N)&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">]:</span>
                <span class="n">ProbeType</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">new_probe_type_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">PopulateException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;User chose not to add probe type &#39;</span><span class="si">{</span><span class="n">probe_type</span><span class="si">}</span><span class="s2">&#39; to the database.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># effectively else (entry exists)</span>
        <span class="c1"># check whether the values provided match the values stored in the database</span>
        <span class="n">db_dict</span> <span class="o">=</span> <span class="p">(</span><span class="n">ProbeType</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;probe_type&quot;</span><span class="p">:</span> <span class="n">probe_type</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">db_dict</span> <span class="o">!=</span> <span class="n">new_probe_type_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PopulateException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Probe type properties of PyNWB Probe object with name &#39;</span><span class="si">{</span><span class="n">probe_type</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_probe_type_dict</span><span class="si">}</span><span class="s2"> do not match properties of the corresponding database entry: </span><span class="si">{</span><span class="n">db_dict</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">probe_type</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_from_nwbfile</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">nwb_device_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">probe_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">probe_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">contact_side_numbering</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Probe entry and corresponding part table entries using the data in the NWB file.</span>

<span class="sd">        This method will parse the electrodes in the electrodes table, electrode groups (as shanks), and devices</span>
<span class="sd">        (as probes) in the NWB file, but only ones that are associated with the device that matches the given</span>
<span class="sd">        `nwb_device_name`.</span>

<span class="sd">        Note that this code assumes the relatively standard convention where the NWB device corresponds to a Probe,</span>
<span class="sd">        the NWB electrode group corresponds to a Shank, and the NWB electrode corresponds to an Electrode.</span>

<span class="sd">        Example usage:</span>
<span class="sd">        ```</span>
<span class="sd">        sgc.Probe.create_from_nwbfile(</span>
<span class="sd">            nwbfile=nwb_file_name,</span>
<span class="sd">            nwb_device_name=&quot;Device&quot;,</span>
<span class="sd">            probe_id=&quot;Neuropixels 1.0 Giocomo Lab Configuration&quot;,</span>
<span class="sd">            probe_type=&quot;Neuropixels 1.0&quot;,</span>
<span class="sd">            contact_side_numbering=True</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The name of the NWB file.</span>
<span class="sd">        nwb_device_name : str</span>
<span class="sd">            The name of the PyNWB Device object that represents the probe to read in the NWB file.</span>
<span class="sd">        probe_id : str</span>
<span class="sd">            A unique ID for the probe and its configuration, to be used as the primary key for the new Probe entry.</span>
<span class="sd">        probe_type : str</span>
<span class="sd">            The existing ProbeType entry that represents the type of probe being created. It must exist.</span>
<span class="sd">        contact_side_numbering : bool</span>
<span class="sd">            Whether the electrode contacts are facing you when numbering them. Stored in the new Probe entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.common_nwbfile</span> <span class="kn">import</span> <span class="n">Nwbfile</span>

        <span class="n">nwb_file_path</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="n">nwbfile</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">nwb_file_path</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">ProbeType</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;probe_type&quot;</span><span class="p">:</span> <span class="n">probe_type</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No ProbeType found with probe_type &#39;</span><span class="si">{</span><span class="n">probe_type</span><span class="si">}</span><span class="s2">&#39;. Aborting.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">new_probe_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">shank_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">elect_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">probe_id</span>
        <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">probe_type</span>
        <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;contact_side_numbering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="n">contact_side_numbering</span> <span class="k">else</span> <span class="s2">&quot;False&quot;</span>
        <span class="p">)</span>

        <span class="c1"># iterate through the electrodes table in the NWB file</span>
        <span class="c1"># and use the group column (ElectrodeGroup) to create shanks</span>
        <span class="c1"># and use the device attribute of each ElectrodeGroup to create a probe</span>
        <span class="n">created_shanks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># map device name to shank_index (int)</span>
        <span class="n">device_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">elec_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">)):</span>
            <span class="n">electrode_group</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span>
            <span class="n">eg_device_name</span> <span class="o">=</span> <span class="n">electrode_group</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span>

            <span class="c1"># only look at electrodes where the associated device is the one specified</span>
            <span class="k">if</span> <span class="n">eg_device_name</span> <span class="o">==</span> <span class="n">nwb_device_name</span><span class="p">:</span>
                <span class="n">device_found</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># if a Shank has not yet been created from the electrode group, then create it</span>
                <span class="k">if</span> <span class="n">electrode_group</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">created_shanks</span><span class="p">:</span>
                    <span class="n">shank_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">created_shanks</span><span class="p">)</span>
                    <span class="n">created_shanks</span><span class="p">[</span><span class="n">electrode_group</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_index</span>

                    <span class="c1"># build the dictionary of Probe.Shank data</span>
                    <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                    <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank_index</span><span class="p">][</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_probe_dict</span><span class="p">[</span>
                        <span class="s2">&quot;probe_id&quot;</span>
                    <span class="p">]</span>
                    <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank_index</span><span class="p">][</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_index</span>

                <span class="c1"># get the probe shank index associated with this Electrode</span>
                <span class="n">probe_shank</span> <span class="o">=</span> <span class="n">created_shanks</span><span class="p">[</span><span class="n">electrode_group</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

                <span class="c1"># build the dictionary of Probe.Electrode data</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">probe_shank</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;probe_electrode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elec_index</span>
                <span class="k">if</span> <span class="s2">&quot;rel_x&quot;</span> <span class="ow">in</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]:</span>
                    <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;rel_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span>
                        <span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;rel_x&quot;</span>
                    <span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;rel_y&quot;</span> <span class="ow">in</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]:</span>
                    <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;rel_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span>
                        <span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;rel_y&quot;</span>
                    <span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;rel_z&quot;</span> <span class="ow">in</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]:</span>
                    <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;rel_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span>
                        <span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;rel_z&quot;</span>
                    <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_found</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No electrodes in the NWB file were associated with a device named &#39;</span><span class="si">{</span><span class="n">nwb_device_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># insert the Probe, then the Shank parts, and then the Electrode parts</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">new_probe_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">shank</span> <span class="ow">in</span> <span class="n">shank_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">Shank</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">shank</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">elect_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">Electrode</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">electrode</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_device.Probe.insert_from_nwbfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert_from_nwbfile</span><span class="p">(</span><span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_device.Probe.insert_from_nwbfile" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Insert probe devices from an NWB file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwbf</code></td>
          <td>
                <code>pynwb.<span title="pynwb.NWBFile">NWBFile</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source NWB file object.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary read from a user-defined YAML file containing values to replace in the NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>device_name_list</code></td>          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of probe device types found in the NWB file.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_device.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">insert_from_nwbfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert probe devices from an NWB file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwbf : pynwb.NWBFile</span>
<span class="sd">        The source NWB file object.</span>
<span class="sd">    config : dict</span>
<span class="sd">        Dictionary read from a user-defined YAML file containing values to replace in the NWB file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    device_name_list : list</span>
<span class="sd">        List of probe device types found in the NWB file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_probes_types</span><span class="p">,</span> <span class="n">ndx_probes</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_all_probe_names</span><span class="p">(</span><span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">probe_type</span> <span class="ow">in</span> <span class="n">all_probes_types</span><span class="p">:</span>
        <span class="n">new_probe_type_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">new_probe_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">shank_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">elect_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">num_shanks</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">probe_type</span> <span class="ow">in</span> <span class="n">ndx_probes</span><span class="p">:</span>
            <span class="c1"># read probe properties into new_probe_dict from PyNWB extension probe object</span>
            <span class="n">nwb_probe_obj</span> <span class="o">=</span> <span class="n">ndx_probes</span><span class="p">[</span><span class="n">probe_type</span><span class="p">]</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">__read_ndx_probe_data</span><span class="p">(</span>
                <span class="n">nwb_probe_obj</span><span class="p">,</span>
                <span class="n">new_probe_type_dict</span><span class="p">,</span>
                <span class="n">new_probe_dict</span><span class="p">,</span>
                <span class="n">shank_dict</span><span class="p">,</span>
                <span class="n">elect_dict</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># check that number of shanks is consistent</span>
        <span class="n">num_shanks</span> <span class="o">=</span> <span class="n">new_probe_type_dict</span><span class="p">[</span><span class="s2">&quot;num_shanks&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">num_shanks</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">num_shanks</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">shank_dict</span>
        <span class="p">),</span> <span class="s2">&quot;`num_shanks` is not equal to the number of shanks.&quot;</span>

        <span class="c1"># if probe id already exists, do not overwrite anything or create new Shanks and Electrodes</span>
        <span class="c1"># TODO test whether the Shanks and Electrodes in the NWB file match the ones in the database</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">Probe</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;probe_id&quot;</span><span class="p">:</span> <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Probe ID &#39;</span><span class="si">{</span><span class="n">new_probe_dict</span><span class="p">[</span><span class="s1">&#39;probe_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; already exists in the database. Spyglass will use &quot;</span>
                <span class="s2">&quot;that and not create a new Probe, Shanks, or Electrodes.&quot;</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">new_probe_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">shank</span> <span class="ow">in</span> <span class="n">shank_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">Shank</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">shank</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">elect_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">Electrode</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">electrode</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">all_probes_types</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserted probes </span><span class="si">{</span><span class="n">all_probes_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No conforming probe metadata found.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_probes_types</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_device.Probe.get_all_probe_names" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_all_probe_names</span><span class="p">(</span><span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_device.Probe.get_all_probe_names" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Get a list of all device names in the NWB file, after appending and overwriting by the config file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwbf</code></td>
          <td>
                <code>pynwb.<span title="pynwb.NWBFile">NWBFile</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The source NWB file object.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>config</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary read from a user-defined YAML file containing values to replace in the NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>device_name_list</code></td>          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of data acquisition object names found in the NWB file.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_device.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_all_probe_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of all device names in the NWB file, after appending and overwriting by the config file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwbf : pynwb.NWBFile</span>
<span class="sd">        The source NWB file object.</span>
<span class="sd">    config : dict</span>
<span class="sd">        Dictionary read from a user-defined YAML file containing values to replace in the NWB file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    device_name_list : list</span>
<span class="sd">        List of data acquisition object names found in the NWB file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make a dict mapping probe type to PyNWB object for all devices in the NWB file that are</span>
    <span class="c1"># of type ndx_franklab_novela.Probe and thus have the required metadata</span>
    <span class="n">ndx_probes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">device_obj</span><span class="o">.</span><span class="n">probe_type</span><span class="p">:</span> <span class="n">device_obj</span>
        <span class="k">for</span> <span class="n">device_obj</span> <span class="ow">in</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device_obj</span><span class="p">,</span> <span class="n">ndx_franklab_novela</span><span class="o">.</span><span class="n">Probe</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># make a dict mapping probe type to dict of device metadata from the config YAML if exists</span>
    <span class="k">if</span> <span class="s2">&quot;Probe&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">config_probes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">probe_dict</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;Probe&quot;</span><span class="p">]</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">config_probes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="c1"># get all the probe types from the NWB file plus the config YAML</span>
    <span class="n">all_probes_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ndx_probes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">config_probes</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">all_probes_types</span><span class="p">,</span> <span class="n">ndx_probes</span><span class="p">,</span> <span class="n">config_probes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_device.Probe.create_from_nwbfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_from_nwbfile</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">nwb_device_name</span><span class="p">,</span> <span class="n">probe_id</span><span class="p">,</span> <span class="n">probe_type</span><span class="p">,</span> <span class="n">contact_side_numbering</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_device.Probe.create_from_nwbfile" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Create a Probe entry and corresponding part table entries using the data in the NWB file.</p>
<p>This method will parse the electrodes in the electrodes table, electrode groups (as shanks), and devices
(as probes) in the NWB file, but only ones that are associated with the device that matches the given
<code>nwb_device_name</code>.</p>
<p>Note that this code assumes the relatively standard convention where the NWB device corresponds to a Probe,
the NWB electrode group corresponds to a Shank, and the NWB electrode corresponds to an Electrode.</p>
<p>Example usage:</p>
<pre><code>sgc.Probe.create_from_nwbfile(
    nwbfile=nwb_file_name,
    nwb_device_name=&quot;Device&quot;,
    probe_id=&quot;Neuropixels 1.0 Giocomo Lab Configuration&quot;,
    probe_type=&quot;Neuropixels 1.0&quot;,
    contact_side_numbering=True
)
</code></pre>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nwb_device_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the PyNWB Device object that represents the probe to read in the NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>probe_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A unique ID for the probe and its configuration, to be used as the primary key for the new Probe entry.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>probe_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The existing ProbeType entry that represents the type of probe being created. It must exist.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>contact_side_numbering</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the electrode contacts are facing you when numbering them. Stored in the new Probe entry.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_device.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">create_from_nwbfile</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">nwb_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">nwb_device_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">probe_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">probe_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">contact_side_numbering</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Probe entry and corresponding part table entries using the data in the NWB file.</span>

<span class="sd">    This method will parse the electrodes in the electrodes table, electrode groups (as shanks), and devices</span>
<span class="sd">    (as probes) in the NWB file, but only ones that are associated with the device that matches the given</span>
<span class="sd">    `nwb_device_name`.</span>

<span class="sd">    Note that this code assumes the relatively standard convention where the NWB device corresponds to a Probe,</span>
<span class="sd">    the NWB electrode group corresponds to a Shank, and the NWB electrode corresponds to an Electrode.</span>

<span class="sd">    Example usage:</span>
<span class="sd">    ```</span>
<span class="sd">    sgc.Probe.create_from_nwbfile(</span>
<span class="sd">        nwbfile=nwb_file_name,</span>
<span class="sd">        nwb_device_name=&quot;Device&quot;,</span>
<span class="sd">        probe_id=&quot;Neuropixels 1.0 Giocomo Lab Configuration&quot;,</span>
<span class="sd">        probe_type=&quot;Neuropixels 1.0&quot;,</span>
<span class="sd">        contact_side_numbering=True</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The name of the NWB file.</span>
<span class="sd">    nwb_device_name : str</span>
<span class="sd">        The name of the PyNWB Device object that represents the probe to read in the NWB file.</span>
<span class="sd">    probe_id : str</span>
<span class="sd">        A unique ID for the probe and its configuration, to be used as the primary key for the new Probe entry.</span>
<span class="sd">    probe_type : str</span>
<span class="sd">        The existing ProbeType entry that represents the type of probe being created. It must exist.</span>
<span class="sd">    contact_side_numbering : bool</span>
<span class="sd">        Whether the electrode contacts are facing you when numbering them. Stored in the new Probe entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">.common_nwbfile</span> <span class="kn">import</span> <span class="n">Nwbfile</span>

    <span class="n">nwb_file_path</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
    <span class="n">nwbfile</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">nwb_file_path</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">ProbeType</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;probe_type&quot;</span><span class="p">:</span> <span class="n">probe_type</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No ProbeType found with probe_type &#39;</span><span class="si">{</span><span class="n">probe_type</span><span class="si">}</span><span class="s2">&#39;. Aborting.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">new_probe_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">shank_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">elect_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">probe_id</span>
    <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">probe_type</span>
    <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;contact_side_numbering&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="n">contact_side_numbering</span> <span class="k">else</span> <span class="s2">&quot;False&quot;</span>
    <span class="p">)</span>

    <span class="c1"># iterate through the electrodes table in the NWB file</span>
    <span class="c1"># and use the group column (ElectrodeGroup) to create shanks</span>
    <span class="c1"># and use the device attribute of each ElectrodeGroup to create a probe</span>
    <span class="n">created_shanks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># map device name to shank_index (int)</span>
    <span class="n">device_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">elec_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">)):</span>
        <span class="n">electrode_group</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span>
        <span class="n">eg_device_name</span> <span class="o">=</span> <span class="n">electrode_group</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># only look at electrodes where the associated device is the one specified</span>
        <span class="k">if</span> <span class="n">eg_device_name</span> <span class="o">==</span> <span class="n">nwb_device_name</span><span class="p">:</span>
            <span class="n">device_found</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># if a Shank has not yet been created from the electrode group, then create it</span>
            <span class="k">if</span> <span class="n">electrode_group</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">created_shanks</span><span class="p">:</span>
                <span class="n">shank_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">created_shanks</span><span class="p">)</span>
                <span class="n">created_shanks</span><span class="p">[</span><span class="n">electrode_group</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_index</span>

                <span class="c1"># build the dictionary of Probe.Shank data</span>
                <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank_index</span><span class="p">][</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_probe_dict</span><span class="p">[</span>
                    <span class="s2">&quot;probe_id&quot;</span>
                <span class="p">]</span>
                <span class="n">shank_dict</span><span class="p">[</span><span class="n">shank_index</span><span class="p">][</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shank_index</span>

            <span class="c1"># get the probe shank index associated with this Electrode</span>
            <span class="n">probe_shank</span> <span class="o">=</span> <span class="n">created_shanks</span><span class="p">[</span><span class="n">electrode_group</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

            <span class="c1"># build the dictionary of Probe.Electrode data</span>
            <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_probe_dict</span><span class="p">[</span><span class="s2">&quot;probe_id&quot;</span><span class="p">]</span>
            <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;probe_shank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">probe_shank</span>
            <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;probe_electrode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elec_index</span>
            <span class="k">if</span> <span class="s2">&quot;rel_x&quot;</span> <span class="ow">in</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]:</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;rel_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span>
                    <span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;rel_x&quot;</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;rel_y&quot;</span> <span class="ow">in</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]:</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;rel_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span>
                    <span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;rel_y&quot;</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;rel_z&quot;</span> <span class="ow">in</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span><span class="n">elec_index</span><span class="p">]:</span>
                <span class="n">elect_dict</span><span class="p">[</span><span class="n">elec_index</span><span class="p">][</span><span class="s2">&quot;rel_z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwbfile</span><span class="o">.</span><span class="n">electrodes</span><span class="p">[</span>
                    <span class="n">elec_index</span><span class="p">,</span> <span class="s2">&quot;rel_z&quot;</span>
                <span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_found</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No electrodes in the NWB file were associated with a device named &#39;</span><span class="si">{</span><span class="n">nwb_device_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># insert the Probe, then the Shank parts, and then the Electrode parts</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">new_probe_dict</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">shank</span> <span class="ow">in</span> <span class="n">shank_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">Shank</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">shank</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">elect_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">Electrode</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">electrode</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.union_adjacent_index" class="doc doc-heading">
<code class="highlight language-python"><span class="n">union_adjacent_index</span><span class="p">(</span><span class="n">interval1</span><span class="p">,</span> <span class="n">interval2</span><span class="p">)</span></code>

<a href="#src.spyglass.spikesorting.spikesorting_recording.union_adjacent_index" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>unions two intervals that are adjacent in index
e.g. [a,b] and [b+1, c] is converted to [a,c]
if not adjacent, just concatenates interval2 at the end of interval1</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>interval1</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[description]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>interval2</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[description]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_interval.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">union_adjacent_index</span><span class="p">(</span><span class="n">interval1</span><span class="p">,</span> <span class="n">interval2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;unions two intervals that are adjacent in index</span>
<span class="sd">    e.g. [a,b] and [b+1, c] is converted to [a,c]</span>
<span class="sd">    if not adjacent, just concatenates interval2 at the end of interval1</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    interval1 : np.array</span>
<span class="sd">        [description]</span>
<span class="sd">    interval2 : np.array</span>
<span class="sd">        [description]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">interval1</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interval1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">interval1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interval2</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interval2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">interval2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">interval1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">interval2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="ow">or</span> <span class="n">interval2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">interval1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">interval1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">interval2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">interval1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">interval2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]),</span>
                <span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">interval1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">interval1</span><span class="p">,</span> <span class="n">interval2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.spikesorting.spikesorting_recording.SpikeSortingRecording" class="doc doc-heading">
        <code>SpikeSortingRecording</code>


<a href="#src.spyglass.spikesorting.spikesorting_recording.SpikeSortingRecording" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Computed">Computed</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/spikesorting/spikesorting_recording.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">SpikeSortingRecording</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Computed</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; SpikeSortingRecordingSelection</span>
<span class="s2">    ---</span>
<span class="s2">    recording_path: varchar(1000)</span>
<span class="s2">    -&gt; IntervalList.proj(sort_interval_list_name=&#39;interval_list_name&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">sort_interval_valid_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sort_interval_valid_times</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">recording</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filtered_recording</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">recording_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recording_name</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">tmp_key</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;interval_list_name&quot;</span><span class="p">:</span> <span class="n">recording_name</span><span class="p">,</span>
            <span class="s2">&quot;valid_times&quot;</span><span class="p">:</span> <span class="n">sort_interval_valid_times</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">IntervalList</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">tmp_key</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># store the list of valid times for the sort</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_interval_list_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_key</span><span class="p">[</span><span class="s2">&quot;interval_list_name&quot;</span><span class="p">]</span>

        <span class="c1"># Path to files that will hold the recording extractors</span>
        <span class="n">recording_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SPYGLASS_RECORDING_DIR&quot;</span><span class="p">))</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;recording_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">recording_folder</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">recording_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;recording_path&quot;</span><span class="p">]):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;recording_path&quot;</span><span class="p">])</span>
        <span class="n">recording</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">folder</span><span class="o">=</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;recording_path&quot;</span><span class="p">],</span> <span class="n">chunk_duration</span><span class="o">=</span><span class="s2">&quot;10000ms&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_recording_name</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="n">recording_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_interval_name&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;preproc_params_name&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">recording_name</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_recording_timestamps</span><span class="p">(</span><span class="n">recording</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">recording</span><span class="o">.</span><span class="n">get_num_segments</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">frames_per_segment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">recording</span><span class="o">.</span><span class="n">get_num_segments</span><span class="p">()):</span>
                <span class="n">frames_per_segment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">recording</span><span class="o">.</span><span class="n">get_num_frames</span><span class="p">(</span><span class="n">segment_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="n">cumsum_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">frames_per_segment</span><span class="p">)</span>
            <span class="n">total_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">frames_per_segment</span><span class="p">)</span>

            <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">total_frames</span><span class="p">,))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">recording</span><span class="o">.</span><span class="n">get_num_segments</span><span class="p">()):</span>
                <span class="n">timestamps</span><span class="p">[</span>
                    <span class="n">cumsum_frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">cumsum_frames</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">get_times</span><span class="p">(</span><span class="n">segment_index</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">timestamps</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">timestamps</span>

    <span class="k">def</span> <span class="nf">_get_sort_interval_valid_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies the intersection between sort interval specified by the user</span>
<span class="sd">        and the valid times (times for which neural data exist)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: dict</span>
<span class="sd">            specifies a (partially filled) entry of SpikeSorting table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sort_interval_valid_times: ndarray of tuples</span>
<span class="sd">            (start, end) times for valid stretches of the sorting interval</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sort_interval</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">SortInterval</span>
            <span class="o">&amp;</span> <span class="p">{</span>
                <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;sort_interval_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_interval_name&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;sort_interval&quot;</span><span class="p">)</span>
        <span class="n">interval_list_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">SpikeSortingRecordingSelection</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span>
            <span class="s2">&quot;interval_list_name&quot;</span>
        <span class="p">)</span>
        <span class="n">valid_interval_times</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">IntervalList</span>
            <span class="o">&amp;</span> <span class="p">{</span>
                <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;interval_list_name&quot;</span><span class="p">:</span> <span class="n">interval_list_name</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;valid_times&quot;</span><span class="p">)</span>
        <span class="n">valid_sort_times</span> <span class="o">=</span> <span class="n">interval_list_intersect</span><span class="p">(</span>
            <span class="n">sort_interval</span><span class="p">,</span> <span class="n">valid_interval_times</span>
        <span class="p">)</span>
        <span class="c1"># Exclude intervals shorter than specified length</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">SpikeSortingPreprocessingParameters</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span>
            <span class="s2">&quot;preproc_params&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;min_segment_length&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">valid_sort_times</span> <span class="o">=</span> <span class="n">intervals_by_length</span><span class="p">(</span>
                <span class="n">valid_sort_times</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;min_segment_length&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_sort_times</span>

    <span class="k">def</span> <span class="nf">_get_filtered_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filters and references a recording</span>
<span class="sd">        * Loads the NWB file created during insertion as a spikeinterface Recording</span>
<span class="sd">        * Slices recording in time (interval) and space (channels);</span>
<span class="sd">          recording chunks from disjoint intervals are concatenated</span>
<span class="sd">        * Applies referencing and bandpass filtering</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: dict,</span>
<span class="sd">            primary key of SpikeSortingRecording table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        recording: si.Recording</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nwb_file_abs_path</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="p">()</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">])</span>
        <span class="n">recording</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">read_nwb_recording</span><span class="p">(</span>
            <span class="n">nwb_file_abs_path</span><span class="p">,</span> <span class="n">load_time_vector</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">valid_sort_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sort_interval_valid_times</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="c1"># shape is (N, 2)</span>
        <span class="n">valid_sort_times_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">recording</span><span class="o">.</span><span class="n">get_times</span><span class="p">(),</span> <span class="n">interval</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">valid_sort_times</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># join intervals of indices that are adjacent</span>
        <span class="n">valid_sort_times_indices</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
            <span class="n">union_adjacent_index</span><span class="p">,</span> <span class="n">valid_sort_times_indices</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">valid_sort_times_indices</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">valid_sort_times_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="n">valid_sort_times_indices</span><span class="p">,</span> <span class="mi">0</span>
            <span class="p">)</span>

        <span class="c1"># create an AppendRecording if there is more than one disjoint sort interval</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_sort_times_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">recordings_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">interval_indices</span> <span class="ow">in</span> <span class="n">valid_sort_times_indices</span><span class="p">:</span>
                <span class="n">recording_single</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">frame_slice</span><span class="p">(</span>
                    <span class="n">start_frame</span><span class="o">=</span><span class="n">interval_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">end_frame</span><span class="o">=</span><span class="n">interval_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">recordings_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recording_single</span><span class="p">)</span>
            <span class="n">recording</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">append_recordings</span><span class="p">(</span><span class="n">recordings_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recording</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">frame_slice</span><span class="p">(</span>
                <span class="n">start_frame</span><span class="o">=</span><span class="n">valid_sort_times_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">end_frame</span><span class="o">=</span><span class="n">valid_sort_times_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="n">channel_ids</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">SortGroup</span><span class="o">.</span><span class="n">SortGroupElectrode</span>
            <span class="o">&amp;</span> <span class="p">{</span>
                <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;sort_group_id&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;electrode_id&quot;</span><span class="p">)</span>
        <span class="n">ref_channel_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">SortGroup</span>
            <span class="o">&amp;</span> <span class="p">{</span>
                <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;sort_group_id&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;sort_group_id&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;sort_reference_electrode_id&quot;</span><span class="p">)</span>
        <span class="n">channel_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">channel_ids</span><span class="p">,</span> <span class="n">ref_channel_id</span><span class="p">)</span>

        <span class="c1"># include ref channel in first slice, then exclude it in second slice</span>
        <span class="k">if</span> <span class="n">ref_channel_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">channel_ids_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_ids</span><span class="p">,</span> <span class="n">ref_channel_id</span><span class="p">)</span>
            <span class="n">recording</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">channel_slice</span><span class="p">(</span><span class="n">channel_ids</span><span class="o">=</span><span class="n">channel_ids_ref</span><span class="p">)</span>

            <span class="n">recording</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">common_reference</span><span class="p">(</span>
                <span class="n">recording</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="n">ref_channel_ids</span><span class="o">=</span><span class="n">ref_channel_id</span>
            <span class="p">)</span>
            <span class="n">recording</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">channel_slice</span><span class="p">(</span><span class="n">channel_ids</span><span class="o">=</span><span class="n">channel_ids</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ref_channel_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">recording</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">channel_slice</span><span class="p">(</span><span class="n">channel_ids</span><span class="o">=</span><span class="n">channel_ids</span><span class="p">)</span>
            <span class="n">recording</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">common_reference</span><span class="p">(</span>
                <span class="n">recording</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s2">&quot;median&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid reference channel ID&quot;</span><span class="p">)</span>
        <span class="n">filter_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">SpikeSortingPreprocessingParameters</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span>
            <span class="s2">&quot;preproc_params&quot;</span>
        <span class="p">)</span>
        <span class="n">recording</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">bandpass_filter</span><span class="p">(</span>
            <span class="n">recording</span><span class="p">,</span>
            <span class="n">freq_min</span><span class="o">=</span><span class="n">filter_params</span><span class="p">[</span><span class="s2">&quot;frequency_min&quot;</span><span class="p">],</span>
            <span class="n">freq_max</span><span class="o">=</span><span class="n">filter_params</span><span class="p">[</span><span class="s2">&quot;frequency_max&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># if the sort group is a tetrode, change the channel location</span>
        <span class="c1"># note that this is a workaround that would be deprecated when spikeinterface uses 3D probe locations</span>
        <span class="n">probe_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">electrode_group</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">channel_id</span> <span class="ow">in</span> <span class="n">channel_ids</span><span class="p">:</span>
            <span class="n">probe_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">Electrode</span> <span class="o">*</span> <span class="n">Probe</span>
                    <span class="o">&amp;</span> <span class="p">{</span>
                        <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;electrode_id&quot;</span><span class="p">:</span> <span class="n">channel_id</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;probe_type&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">electrode_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">Electrode</span>
                    <span class="o">&amp;</span> <span class="p">{</span>
                        <span class="s2">&quot;nwb_file_name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;electrode_id&quot;</span><span class="p">:</span> <span class="n">channel_id</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;electrode_group_name&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="s2">&quot;tetrode_12.5&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probe_type</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">probe_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
            <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">eg</span> <span class="o">==</span> <span class="n">electrode_group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">eg</span> <span class="ow">in</span> <span class="n">electrode_group</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">tetrode</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">]]</span>
            <span class="n">tetrode</span><span class="o">.</span><span class="n">set_contacts</span><span class="p">(</span>
                <span class="n">position</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">shape_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="mf">6.25</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">tetrode</span><span class="o">.</span><span class="n">set_contact_ids</span><span class="p">(</span><span class="n">channel_ids</span><span class="p">)</span>
            <span class="n">tetrode</span><span class="o">.</span><span class="n">set_device_channel_indices</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">recording</span> <span class="o">=</span> <span class="n">recording</span><span class="o">.</span><span class="n">set_probe</span><span class="p">(</span><span class="n">tetrode</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">recording</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../spikesorting_curation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: spikesorting_curation.py" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                spikesorting_curation.py
              </div>
            </div>
          </a>
        
        
          
          <a href="../spikesorting_sorting/" class="md-footer__link md-footer__link--next" aria-label="Next: spikesorting_sorting.py" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                spikesorting_sorting.py
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2020-present Loren Frank
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/LorenFrankLab/spyglass" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/spyglass-neuro/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["toc.integrate", "navigation.sections", "navigation.expand", "navigation.top", "navigation.instant", "navigation.tracking", "navigation.top", "search.suggest", "search.share", "navigation.footer"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.b425cdc4.min.js"></script>
      
    
  </body>
</html>