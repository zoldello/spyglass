
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Spyglass Documentation">
      
      
        <meta name="author" content="CBroz1">
      
      
        <link rel="canonical" href="https://lorenfranklab.github.io/spyglass/latest/api/src/spyglass/position/v1/position_dlc_centroid/">
      
      
        <link rel="prev" href="../dlc_utils/">
      
      
        <link rel="next" href="../position_dlc_cohort/">
      
      <link rel="icon" href="../../../../../../images/Spyglass.svg">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.17">
    
    
      
        <title>position_dlc_centroid.py - Spyglass</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="auto" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.spyglass.position.v1.position_dlc_centroid" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="Spyglass" class="md-header__button md-logo" aria-label="Spyglass" data-md-component="logo">
      
  <img src="../../../../../../images/FrankLab.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spyglass
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              position_dlc_centroid.py
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="auto" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: slate)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/LorenFrankLab/spyglass" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Spyglass" class="md-nav__button md-logo" aria-label="Spyglass" data-md-component="logo">
      
  <img src="../../../../../../images/FrankLab.png" alt="logo">

    </a>
    Spyglass
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LorenFrankLab/spyglass" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../installation/" class="md-nav__link">
        Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../installation/local/" class="md-nav__link">
        Local
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../installation/production/" class="md-nav__link">
        Productions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/00_intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/01_spikesorting/" class="md-nav__link">
        Spike Sorting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/02_curation/" class="md-nav__link">
        Curation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/03_lfp/" class="md-nav__link">
        LFP
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Position
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Position
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/4_position_info/" class="md-nav__link">
        Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/04_Trodes_position/" class="md-nav__link">
        Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/05_DLC_from_scratch/" class="md-nav__link">
        From Scratch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/06_DLC_from_dir/" class="md-nav__link">
        From Pre-Trained
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/07_linearization/" class="md-nav__link">
        Linearization Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/08_Extract_Mark_indicators/" class="md-nav__link">
        Mark Indicators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/09_Decoding_with_GPUs_on_the_GPU_cluster/" class="md-nav__link">
        GPU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/10_1D_Clusterless_Decoding/" class="md-nav__link">
        1D Clusterless Decoding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/11_2D_Clusterless_Decoding/" class="md-nav__link">
        2D Clusterless Decoding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/12_Ripple_Detection/" class="md-nav__link">
        Ripple Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/docker_mysql_tutorial/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../notebooks/Spyglass_kachery_setup/" class="md-nav__link">
        Spyglass Kachery Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          src
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          src
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
          spyglass
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_1_1">
          <span class="md-nav__icon md-icon"></span>
          spyglass
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../_version/" class="md-nav__link">
        _version.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_2" id="__nav_4_1_1_2_label" tabindex="0">
          cli
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_2">
          <span class="md-nav__icon md-icon"></span>
          cli
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/cli/" class="md-nav__link">
        cli.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_3" id="__nav_4_1_1_3_label" tabindex="0">
          common
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_3">
          <span class="md-nav__icon md-icon"></span>
          common
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_backup/" class="md-nav__link">
        common_backup.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_behav/" class="md-nav__link">
        common_behav.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_device/" class="md-nav__link">
        common_device.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_dio/" class="md-nav__link">
        common_dio.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_ephys/" class="md-nav__link">
        common_ephys.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_filter/" class="md-nav__link">
        common_filter.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_interval/" class="md-nav__link">
        common_interval.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_lab/" class="md-nav__link">
        common_lab.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_nwbfile/" class="md-nav__link">
        common_nwbfile.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_position/" class="md-nav__link">
        common_position.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_region/" class="md-nav__link">
        common_region.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_ripple/" class="md-nav__link">
        common_ripple.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_sensors/" class="md-nav__link">
        common_sensors.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_session/" class="md-nav__link">
        common_session.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_subject/" class="md-nav__link">
        common_subject.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/common_task/" class="md-nav__link">
        common_task.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/errors/" class="md-nav__link">
        errors.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/populate_all_common/" class="md-nav__link">
        populate_all_common.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_3_19" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_3_19" id="__nav_4_1_1_3_19_label" tabindex="0">
          prepopulate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_3_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_3_19">
          <span class="md-nav__icon md-icon"></span>
          prepopulate
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/prepopulate/prepopulate/" class="md-nav__link">
        prepopulate.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/signal_processing/" class="md-nav__link">
        signal_processing.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_4" id="__nav_4_1_1_4_label" tabindex="0">
          data_import
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_4">
          <span class="md-nav__icon md-icon"></span>
          data_import
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../data_import/insert_sessions/" class="md-nav__link">
        insert_sessions.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../data_import/storage_dirs/" class="md-nav__link">
        storage_dirs.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_5" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_5" id="__nav_4_1_1_5_label" tabindex="0">
          decoding
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_5">
          <span class="md-nav__icon md-icon"></span>
          decoding
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../decoding/clusterless/" class="md-nav__link">
        clusterless.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../decoding/core/" class="md-nav__link">
        core.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../decoding/dj_decoder_conversion/" class="md-nav__link">
        dj_decoder_conversion.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../decoding/sorted_spikes/" class="md-nav__link">
        sorted_spikes.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../decoding/visualization/" class="md-nav__link">
        visualization.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../decoding/visualization_1D_view/" class="md-nav__link">
        visualization_1D_view.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../decoding/visualization_2D_view/" class="md-nav__link">
        visualization_2D_view.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_6" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_6" id="__nav_4_1_1_6_label" tabindex="0">
          figurl_views
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_6">
          <span class="md-nav__icon md-icon"></span>
          figurl_views
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../figurl_views/SpikeSortingRecordingView/" class="md-nav__link">
        SpikeSortingRecordingView.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../figurl_views/SpikeSortingView/" class="md-nav__link">
        SpikeSortingView.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../figurl_views/prepare_spikesortingview_data/" class="md-nav__link">
        prepare_spikesortingview_data.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_7" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_7" id="__nav_4_1_1_7_label" tabindex="0">
          lfp
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_7">
          <span class="md-nav__icon md-icon"></span>
          lfp
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lfp/lfp_merge/" class="md-nav__link">
        lfp_merge.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_7_2" id="__nav_4_1_1_7_2_label" tabindex="0">
          v1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_7_2">
          <span class="md-nav__icon md-icon"></span>
          v1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lfp/v1/lfp/" class="md-nav__link">
        lfp.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lfp/v1/lfp_artifact/" class="md-nav__link">
        lfp_artifact.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lfp/v1/lfp_artifact_MAD_detection/" class="md-nav__link">
        lfp_artifact_MAD_detection.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lfp/v1/lfp_artifact_difference_detection/" class="md-nav__link">
        lfp_artifact_difference_detection.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_8" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_8" id="__nav_4_1_1_8_label" tabindex="0">
          lfp_band
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_8">
          <span class="md-nav__icon md-icon"></span>
          lfp_band
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lfp_band/lfp_band_merge/" class="md-nav__link">
        lfp_band_merge.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_8_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_8_2" id="__nav_4_1_1_8_2_label" tabindex="0">
          v1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_8_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_8_2">
          <span class="md-nav__icon md-icon"></span>
          v1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lfp_band/v1/lfp_band/" class="md-nav__link">
        lfp_band.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_9" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_9" id="__nav_4_1_1_9_label" tabindex="0">
          lock
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_9">
          <span class="md-nav__icon md-icon"></span>
          lock
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../lock/file_lock/" class="md-nav__link">
        file_lock.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1_10" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_10" id="__nav_4_1_1_10_label" tabindex="0">
          position
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_10_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_1_1_10">
          <span class="md-nav__icon md-icon"></span>
          position
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../position_merge/" class="md-nav__link">
        position_merge.py
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1_10_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_10_2" id="__nav_4_1_1_10_2_label" tabindex="0">
          v1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_1_1_10_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_1_1_10_2">
          <span class="md-nav__icon md-icon"></span>
          v1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dlc_decorators/" class="md-nav__link">
        dlc_decorators.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dlc_reader/" class="md-nav__link">
        dlc_reader.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dlc_utils/" class="md-nav__link">
        dlc_utils.py
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          position_dlc_centroid.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        position_dlc_centroid.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid" class="md-nav__link">
    src.spyglass.position.v1.position_dlc_centroid
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.DLCSmoothInterpParams" class="md-nav__link">
    DLCSmoothInterpParams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams" class="md-nav__link">
    DLCCentroidParams
  </a>
  
    <nav class="md-nav" aria-label="DLCCentroidParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams.insert_default" class="md-nav__link">
    insert_default()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams.insert1" class="md-nav__link">
    insert1()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.DLCSmoothInterpCohort" class="md-nav__link">
    DLCSmoothInterpCohort
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.fetch_nwb" class="md-nav__link">
    fetch_nwb()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.RawPosition" class="md-nav__link">
    RawPosition
  </a>
  
    <nav class="md-nav" aria-label="RawPosition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.RawPosition--notes" class="md-nav__link">
    Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.AnalysisNwbfile" class="md-nav__link">
    AnalysisNwbfile
  </a>
  
    <nav class="md-nav" aria-label="AnalysisNwbfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.create" class="md-nav__link">
    create()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.copy" class="md-nav__link">
    copy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add" class="md-nav__link">
    add()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_nwb_object" class="md-nav__link">
    add_nwb_object()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units" class="md-nav__link">
    add_units()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units_waveforms" class="md-nav__link">
    add_units_waveforms()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units_metrics" class="md-nav__link">
    add_units_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.get_electrode_indices" class="md-nav__link">
    get_electrode_indices()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.cleanup" class="md-nav__link">
    cleanup()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidSelection" class="md-nav__link">
    DLCCentroidSelection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroid" class="md-nav__link">
    DLCCentroid
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.four_led_centroid" class="md-nav__link">
    four_led_centroid()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.get_span_start_stop" class="md-nav__link">
    get_span_start_stop()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.two_pt_centroid" class="md-nav__link">
    two_pt_centroid()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.spyglass.position.v1.position_dlc_centroid.one_pt_centroid" class="md-nav__link">
    one_pt_centroid()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_cohort/" class="md-nav__link">
        position_dlc_cohort.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_model/" class="md-nav__link">
        position_dlc_model.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_orient/" class="md-nav__link">
        position_dlc_orient.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_pose_estimation/" class="md-nav__link">
        position_dlc_pose_estimation.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_position/" class="md-nav__link">
        position_dlc_position.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_project/" class="md-nav__link">
        position_dlc_project.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_selection/" class="md-nav__link">
        position_dlc_selection.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_dlc_training/" class="md-nav__link">
        position_dlc_training.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../position_trodes_position/" class="md-nav__link">
        position_trodes_position.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../settings/" class="md-nav__link">
        settings.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_12" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_12" id="__nav_4_1_1_12_label" tabindex="0">
          sharing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_12">
          <span class="md-nav__icon md-icon"></span>
          sharing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sharing/sharing_kachery/" class="md-nav__link">
        sharing_kachery.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_13" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_13" id="__nav_4_1_1_13_label" tabindex="0">
          spikesorting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_13">
          <span class="md-nav__icon md-icon"></span>
          spikesorting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/curation_figurl/" class="md-nav__link">
        curation_figurl.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/merged_sorting_extractor/" class="md-nav__link">
        merged_sorting_extractor.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/sortingview/" class="md-nav__link">
        sortingview.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/sortingview_helper_fn/" class="md-nav__link">
        sortingview_helper_fn.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/spikesorting_artifact/" class="md-nav__link">
        spikesorting_artifact.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/spikesorting_curation/" class="md-nav__link">
        spikesorting_curation.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/spikesorting_recording/" class="md-nav__link">
        spikesorting_recording.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spikesorting/spikesorting_sorting/" class="md-nav__link">
        spikesorting_sorting.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1_1_14" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1_1_14" id="__nav_4_1_1_14_label" tabindex="0">
          utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_1_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1_1_14">
          <span class="md-nav__icon md-icon"></span>
          utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/dj_helper_fn/" class="md-nav__link">
        dj_helper_fn.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/dj_merge_tables/" class="md-nav__link">
        dj_merge_tables.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/nwb_helper_fn/" class="md-nav__link">
        nwb_helper_fn.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../contribute/" class="md-nav__link">
        How to Contribute
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../misc/figurl_views/" class="md-nav__link">
        FigURL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../misc/session_groups/" class="md-nav__link">
        Session Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../misc/insert_data/" class="md-nav__link">
        Insert Data
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../CHANGELOG/" class="md-nav__link">
        Change Log
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../LICENSE/" class="md-nav__link">
        Copyright
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>position_dlc_centroid.py</h1>

<div class="doc doc-object doc-module">


<a id="src.spyglass.position.v1.position_dlc_centroid"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">







<div class="doc doc-object doc-class">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.DLCSmoothInterpParams" class="doc doc-heading">
        <code>DLCSmoothInterpParams</code>


<a href="#src.spyglass.position.v1.position_dlc_centroid.DLCSmoothInterpParams" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>

  
      <p>Parameters for extracting the smoothed head position.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>interpolate</code></td>
          <td>
                <code>bool, default True</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to interpolate over NaN spans</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>smooth</code></td>
          <td>
                <code>bool, default True</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>whether to smooth the dataset</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>smoothing_params</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>smoothing_duration : float, default 0.05
number of frames to smooth over: sampling_rate*smoothing_duration = num_frames</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>interp_params</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>max_cm_to_interp : int, default 20
maximum distance between high likelihood points on either side of a NaN span
to interpolate over</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>likelihood_thresh</code></td>
          <td>
                <code>float, default 0.95</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>likelihood below which to NaN and interpolate over</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>src/spyglass/position/v1/position_dlc_position.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">DLCSmoothInterpParams</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters for extracting the smoothed head position.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    interpolate : bool, default True</span>
<span class="sd">        whether to interpolate over NaN spans</span>
<span class="sd">    smooth : bool, default True</span>
<span class="sd">        whether to smooth the dataset</span>
<span class="sd">    smoothing_params : dict</span>
<span class="sd">        smoothing_duration : float, default 0.05</span>
<span class="sd">            number of frames to smooth over: sampling_rate*smoothing_duration = num_frames</span>
<span class="sd">    interp_params : dict</span>
<span class="sd">        max_cm_to_interp : int, default 20</span>
<span class="sd">            maximum distance between high likelihood points on either side of a NaN span</span>
<span class="sd">            to interpolate over</span>
<span class="sd">    likelihood_thresh : float, default 0.95</span>
<span class="sd">        likelihood below which to NaN and interpolate over</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    dlc_si_params_name : varchar(80) # name for this set of parameters</span>
<span class="s2">    ---</span>
<span class="s2">    params: longblob # dictionary of parameters</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert_params</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">params_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">:</span> <span class="n">params_name</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert_default</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">default_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;smooth&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;smoothing_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;smoothing_duration&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
                <span class="s2">&quot;smooth_method&quot;</span><span class="p">:</span> <span class="s2">&quot;moving_avg&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;likelihood_thresh&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="s2">&quot;interp_params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;max_cm_to_interp&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">},</span>
            <span class="s2">&quot;max_cm_between_pts&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="c1"># This is for use when finding &quot;good spans&quot; and is how many indices to bridge in between good spans</span>
            <span class="c1"># see inds_to_span in get_good_spans</span>
            <span class="s2">&quot;num_inds_to_span&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">default_params</span><span class="p">},</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert_nan_params</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">nan_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;smooth&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;likelihood_thresh&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="s2">&quot;max_cm_between_pts&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s2">&quot;num_inds_to_span&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;just_nan&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">nan_params</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">cls</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">cls</span><span class="p">()</span><span class="o">.</span><span class="n">insert_default</span><span class="p">(</span><span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">default</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">default</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_nan_params</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">cls</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;just_nan&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">cls</span><span class="p">()</span><span class="o">.</span><span class="n">insert_nan_params</span><span class="p">(</span><span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">nan_params</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;just_nan&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nan_params</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nan_params</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_available_methods</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">_key_to_smooth_func_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;params&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;max_cm_between_pts&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;max_cm_between_pts is a required parameter&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;smooth&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;smooth&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s2">&quot;smoothing_params&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s2">&quot;smooth_method&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]:</span>
                            <span class="n">smooth_method</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span>
                                <span class="s2">&quot;smooth_method&quot;</span>
                            <span class="p">]</span>
                            <span class="k">if</span> <span class="n">smooth_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_key_to_smooth_func_dict</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;smooth_method: </span><span class="si">{</span><span class="n">smooth_method</span><span class="si">}</span><span class="s2"> not an available method.&quot;</span>
                                <span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="ow">not</span> <span class="s2">&quot;smoothing_duration&quot;</span>
                            <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                                <span class="s2">&quot;smoothing_duration must be passed as a smoothing_params within key[&#39;params&#39;]&quot;</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span>
                                    <span class="s2">&quot;smoothing_duration&quot;</span>
                                <span class="p">],</span>
                                <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                            <span class="p">),</span> <span class="s2">&quot;smoothing_duration must be a float or int&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;smoothing_params not in key[&#39;params&#39;]&quot;</span>
                        <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;likelihood_thresh&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;likelihood_thresh&quot;</span><span class="p">],</span>
                    <span class="nb">float</span><span class="p">,</span>
                <span class="p">),</span> <span class="s2">&quot;likelihood_thresh must be a float&quot;</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;likelihood_thresh&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span>
                <span class="p">),</span> <span class="s2">&quot;likelihood_thresh must be between 0 and 1&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;likelihood_thresh must be passed within key[&#39;params&#39;]&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;&#39;params&#39; must be in key&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams" class="doc doc-heading">
        <code>DLCCentroidParams</code>


<a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>

  
      <p>Parameters for calculating the centroid</p>


        <details class="quote">
          <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">DLCCentroidParams</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters for calculating the centroid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: whether to keep all params in a params dict</span>
    <span class="c1"># or break out into individual secondary keys</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    dlc_centroid_params_name: varchar(80) # name for this set of parameters</span>
<span class="s2">    ---</span>
<span class="s2">    params: longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">_available_centroid_methods</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;four_led_centroid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;two_pt_centroid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;one_pt_centroid&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">_four_led_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;greenLED&quot;</span><span class="p">,</span> <span class="s2">&quot;redLED_L&quot;</span><span class="p">,</span> <span class="s2">&quot;redLED_C&quot;</span><span class="p">,</span> <span class="s2">&quot;redLED_R&quot;</span><span class="p">]</span>
    <span class="n">_two_pt_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;point1&quot;</span><span class="p">,</span> <span class="s2">&quot;point2&quot;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">insert_default</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts default centroid parameters. Assumes 2 LEDs tracked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;centroid_method&quot;</span><span class="p">:</span> <span class="s2">&quot;two_pt_centroid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;point1&quot;</span><span class="p">:</span> <span class="s2">&quot;greenLED&quot;</span><span class="p">,</span>
                <span class="s2">&quot;point2&quot;</span><span class="p">:</span> <span class="s2">&quot;redLED_C&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;interp_params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;max_cm_to_interp&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">},</span>
            <span class="s2">&quot;smooth&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;smoothing_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;smoothing_duration&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
                <span class="s2">&quot;smooth_method&quot;</span><span class="p">:</span> <span class="s2">&quot;moving_avg&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;max_LED_separation&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
            <span class="s2">&quot;speed_smoothing_std_dev&quot;</span><span class="p">:</span> <span class="mf">0.100</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;dlc_centroid_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">cls</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;dlc_centroid_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">cls</span><span class="p">()</span><span class="o">.</span><span class="n">insert_default</span><span class="p">(</span><span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">default</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;dlc_centroid_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">default</span>

    <span class="k">def</span> <span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check provided parameter dictionary to make sure</span>
<span class="sd">        it contains all necessary items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;centroid_method&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_centroid_methods</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;four_led_centroid&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_four_led_labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Please make sure to specify all necessary labels: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_four_led_labels</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;if using the &#39;four_led_centroid&#39; method&quot;</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;two_pt_centroid&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_two_pt_labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Please make sure to specify all necessary labels: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_two_pt_labels</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;if using the &#39;two_pt_centroid&#39; method&quot;</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;one_pt_centroid&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;point1&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="s2">&quot;Please make sure to specify the necessary label: &quot;</span>
                            <span class="s2">&quot;&#39;point1&#39; &quot;</span>
                            <span class="s2">&quot;if using the &#39;one_pt_centroid&#39; method&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This shouldn&#39;t happen lol oops&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The given &#39;centroid_method&#39;: </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;centroid_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;is not in the available methods: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_available_centroid_methods</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;centroid_method&#39; needs to be provided as a parameter&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;max_LED_separation&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_LED_separation&quot;</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;parameter &#39;max_LED_separation&#39; is type: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_LED_separation&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;it should be one of type (float, int)&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;smooth&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smooth&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;smoothing_params&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;smooth_method&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]:</span>
                        <span class="n">smooth_method</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;smooth_method&quot;</span>
                        <span class="p">]</span>
                        <span class="k">if</span> <span class="n">smooth_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_key_to_smooth_func_dict</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;smooth_method: </span><span class="si">{</span><span class="n">smooth_method</span><span class="si">}</span><span class="s2"> not an available method.&quot;</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;smoothing_duration&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="s2">&quot;smoothing_duration must be passed as a smoothing_params within key[&#39;params&#39;]&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span><span class="s2">&quot;smoothing_duration&quot;</span><span class="p">],</span>
                            <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                        <span class="p">),</span> <span class="s2">&quot;smoothing_duration must be a float or int&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;smoothing_params not in key[&#39;params&#39;]&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams.insert_default" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert_default</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams.insert_default" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Inserts default centroid parameters. Assumes 2 LEDs tracked</p>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">insert_default</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inserts default centroid parameters. Assumes 2 LEDs tracked</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;centroid_method&quot;</span><span class="p">:</span> <span class="s2">&quot;two_pt_centroid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;point1&quot;</span><span class="p">:</span> <span class="s2">&quot;greenLED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;point2&quot;</span><span class="p">:</span> <span class="s2">&quot;redLED_C&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;interpolate&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;interp_params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;max_cm_to_interp&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">},</span>
        <span class="s2">&quot;smooth&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;smoothing_params&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;smoothing_duration&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="s2">&quot;smooth_method&quot;</span><span class="p">:</span> <span class="s2">&quot;moving_avg&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;max_LED_separation&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s2">&quot;speed_smoothing_std_dev&quot;</span><span class="p">:</span> <span class="mf">0.100</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;dlc_centroid_params_name&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams.insert1" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidParams.insert1" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Check provided parameter dictionary to make sure
it contains all necessary items</p>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check provided parameter dictionary to make sure</span>
<span class="sd">    it contains all necessary items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;centroid_method&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_centroid_methods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;four_led_centroid&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_four_led_labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Please make sure to specify all necessary labels: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_four_led_labels</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;if using the &#39;four_led_centroid&#39; method&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;two_pt_centroid&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_two_pt_labels</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Please make sure to specify all necessary labels: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_two_pt_labels</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;if using the &#39;two_pt_centroid&#39; method&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;one_pt_centroid&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;point1&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s2">&quot;Please make sure to specify the necessary label: &quot;</span>
                        <span class="s2">&quot;&#39;point1&#39; &quot;</span>
                        <span class="s2">&quot;if using the &#39;one_pt_centroid&#39; method&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This shouldn&#39;t happen lol oops&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The given &#39;centroid_method&#39;: </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;centroid_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;is not in the available methods: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_available_centroid_methods</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;centroid_method&#39; needs to be provided as a parameter&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;max_LED_separation&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_LED_separation&quot;</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;parameter &#39;max_LED_separation&#39; is type: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_LED_separation&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;it should be one of type (float, int)&quot;</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;smooth&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smooth&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s2">&quot;smoothing_params&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;smooth_method&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]:</span>
                    <span class="n">smooth_method</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span>
                        <span class="s2">&quot;smooth_method&quot;</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="n">smooth_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_key_to_smooth_func_dict</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;smooth_method: </span><span class="si">{</span><span class="n">smooth_method</span><span class="si">}</span><span class="s2"> not an available method.&quot;</span>
                        <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;smoothing_duration&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s2">&quot;smoothing_duration must be passed as a smoothing_params within key[&#39;params&#39;]&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span><span class="s2">&quot;smoothing_duration&quot;</span><span class="p">],</span>
                        <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                    <span class="p">),</span> <span class="s2">&quot;smoothing_duration must be a float or int&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;smoothing_params not in key[&#39;params&#39;]&quot;</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.DLCSmoothInterpCohort" class="doc doc-heading">
        <code>DLCSmoothInterpCohort</code>


<a href="#src.spyglass.position.v1.position_dlc_centroid.DLCSmoothInterpCohort" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Computed">Computed</span></code></p>

  
      <p>Table to combine multiple bodyparts from DLCSmoothInterp
to enable centroid/orientation calculations</p>


        <details class="quote">
          <summary>Source code in <code>src/spyglass/position/v1/position_dlc_cohort.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">DLCSmoothInterpCohort</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Computed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Table to combine multiple bodyparts from DLCSmoothInterp</span>
<span class="sd">    to enable centroid/orientation calculations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Need to ensure that nwb_file_name/epoch/interval list name endure as primary keys</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; DLCSmoothInterpCohortSelection</span>
<span class="s2">    ---</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">BodyPart</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; DLCSmoothInterpCohort</span>
<span class="s2">        -&gt; DLCSmoothInterp</span>
<span class="s2">        ---</span>
<span class="s2">        -&gt; AnalysisNwbfile</span>
<span class="s2">        dlc_smooth_interp_position_object_id : varchar(80)</span>
<span class="s2">        dlc_smooth_interp_info_object_id : varchar(80)</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">fetch_nwb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fetch_nwb</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="p">(</span><span class="n">AnalysisNwbfile</span><span class="p">,</span> <span class="s2">&quot;analysis_file_abs_path&quot;</span><span class="p">),</span>
                <span class="o">*</span><span class="n">attrs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">fetch1_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">nwb_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_nwb</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                    <span class="n">nwb_data</span><span class="p">[</span><span class="s2">&quot;dlc_smooth_interp_position&quot;</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">get_spatial_series</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">timestamps</span>
                <span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;video_frame_ind&quot;</span><span class="p">,</span>
                <span class="s2">&quot;x&quot;</span><span class="p">,</span>
                <span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">nwb_data</span><span class="p">[</span><span class="s2">&quot;dlc_smooth_interp_info&quot;</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">time_series</span><span class="p">[</span><span class="s2">&quot;video_frame_ind&quot;</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">data</span><span class="p">,</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                        <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="n">nwb_data</span><span class="p">[</span><span class="s2">&quot;dlc_smooth_interp_position&quot;</span><span class="p">]</span>
                            <span class="o">.</span><span class="n">get_spatial_series</span><span class="p">()</span>
                            <span class="o">.</span><span class="n">data</span>
                        <span class="p">),</span>
                    <span class="p">),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">,</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.dlc_utils</span> <span class="kn">import</span> <span class="n">OutputLogger</span><span class="p">,</span> <span class="n">infer_output_dir</span>

        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">infer_output_dir</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">makedir</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OutputLogger</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;nwb_file_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;dlc_model_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_log&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">}</span><span class="s2">/log.log&quot;</span><span class="p">,</span>
            <span class="n">print_console</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-----------------------&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Bodypart Cohort&quot;</span><span class="p">)</span>
            <span class="c1"># from Jen Guidera</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">cohort_selection</span> <span class="o">=</span> <span class="p">(</span><span class="n">DLCSmoothInterpCohortSelection</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">()</span>
            <span class="n">table_entries</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bodyparts_params_dict</span> <span class="o">=</span> <span class="n">cohort_selection</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
                <span class="s2">&quot;bodyparts_params_dict&quot;</span>
            <span class="p">)</span>
            <span class="n">temp_key</span> <span class="o">=</span> <span class="n">cohort_selection</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">bodypart</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">bodyparts_params_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">temp_key</span><span class="p">[</span><span class="s2">&quot;bodypart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bodypart</span>
                <span class="n">temp_key</span><span class="p">[</span><span class="s2">&quot;dlc_si_params_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
                <span class="n">table_entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">DLCSmoothInterp</span> <span class="o">&amp;</span> <span class="n">temp_key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_entries</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">bodyparts_params_dict</span>
            <span class="p">),</span> <span class="s2">&quot;more entries found in DLCSmoothInterp than specified in bodyparts_params_dict&quot;</span>
            <span class="n">table_column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">table_entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">table_entry</span> <span class="ow">in</span> <span class="n">table_entries</span><span class="p">:</span>
                <span class="n">entry_key</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">table_column_names</span><span class="p">,</span> <span class="n">table_entry</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">},</span>
                    <span class="o">**</span><span class="n">key</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">DLCSmoothInterpCohort</span><span class="o">.</span><span class="n">BodyPart</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                    <span class="n">entry_key</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inserted entry into DLCSmoothInterpCohort&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.fetch_nwb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_nwb</span><span class="p">(</span><span class="n">query_expression</span><span class="p">,</span> <span class="n">nwb_master</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#src.spyglass.position.v1.position_dlc_centroid.fetch_nwb" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Get an NWB object from the given DataJoint query.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>query_expression</code></td>
          <td>
                <code>query</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A DataJoint query expression (e.g., join, restrict) or a table to call fetch on.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nwb_master</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tuple (table, attr) to get the NWB filepath from.
i.e. absolute path to NWB file can be obtained by looking up attr column of table
table is usually Nwbfile or AnalysisNwbfile;
attr is usually 'nwb_file_abs_path' or 'analysis_file_abs_path'</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>*attrs</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Attributes from normal DataJoint fetch call.</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Keyword arguments from normal DataJoint fetch call.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>nwb_objects</code></td>          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of dicts containing fetch results and NWB objects.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/utils/dj_helper_fn.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_nwb</span><span class="p">(</span><span class="n">query_expression</span><span class="p">,</span> <span class="n">nwb_master</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get an NWB object from the given DataJoint query.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    query_expression : query</span>
<span class="sd">        A DataJoint query expression (e.g., join, restrict) or a table to call fetch on.</span>
<span class="sd">    nwb_master : tuple</span>
<span class="sd">        Tuple (table, attr) to get the NWB filepath from.</span>
<span class="sd">        i.e. absolute path to NWB file can be obtained by looking up attr column of table</span>
<span class="sd">        table is usually Nwbfile or AnalysisNwbfile;</span>
<span class="sd">        attr is usually &#39;nwb_file_abs_path&#39; or &#39;analysis_file_abs_path&#39;</span>
<span class="sd">    *attrs : list</span>
<span class="sd">        Attributes from normal DataJoint fetch call.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments from normal DataJoint fetch call.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nwb_objects : list</span>
<span class="sd">        List of dicts containing fetch results and NWB objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;as_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># force return as dictionary</span>
    <span class="n">tbl</span><span class="p">,</span> <span class="n">attr_name</span> <span class="o">=</span> <span class="n">nwb_master</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">query_expression</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">names</span>

    <span class="c1"># get the list of analysis or nwb files</span>
    <span class="n">file_name_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;analysis_file_name&quot;</span> <span class="k">if</span> <span class="s2">&quot;analysis&quot;</span> <span class="ow">in</span> <span class="n">nwb_master</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;nwb_file_name&quot;</span>
    <span class="p">)</span>
    <span class="c1"># TODO: avoid this import?</span>
    <span class="kn">from</span> <span class="nn">..common.common_nwbfile</span> <span class="kn">import</span> <span class="n">AnalysisNwbfile</span><span class="p">,</span> <span class="n">Nwbfile</span>

    <span class="n">file_path_fn</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span>
        <span class="k">if</span> <span class="s2">&quot;analysis&quot;</span> <span class="ow">in</span> <span class="n">nwb_master</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span>
    <span class="p">)</span>

    <span class="c1"># TODO: check that the query_expression restricts tbl - CBroz</span>
    <span class="n">nwb_files</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">query_expression</span> <span class="o">*</span> <span class="n">tbl</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">nwb2load_filepath</span><span class="o">=</span><span class="n">attr_name</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">file_name_str</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">nwb_files</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path_fn</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="c1"># retrieve the file from kachery. This also opens the file and stores the file object</span>
            <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="n">rec_dicts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">query_expression</span> <span class="o">*</span> <span class="n">tbl</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">nwb2load_filepath</span><span class="o">=</span><span class="n">attr_name</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="s2">&quot;nwb2load_filepath&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">rec_dicts</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;object_id&quot;</span> <span class="ow">in</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rec_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">rec_dicts</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec_dict</span> <span class="ow">in</span> <span class="n">rec_dicts</span><span class="p">:</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">rec_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;nwb2load_filepath&quot;</span><span class="p">))</span>
        <span class="c1"># for each attr that contains substring &#39;object_id&#39;, store key-value: attr name to NWB object</span>
        <span class="c1"># remove &#39;_object_id&#39; from attr name</span>
        <span class="n">nwb_objs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">id_attr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_object_id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="n">_get_nwb_object</span><span class="p">(</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">objects</span><span class="p">,</span> <span class="n">rec_dict</span><span class="p">[</span><span class="n">id_attr</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">id_attr</span> <span class="ow">in</span> <span class="n">attrs</span>
            <span class="k">if</span> <span class="s2">&quot;object_id&quot;</span> <span class="ow">in</span> <span class="n">id_attr</span> <span class="ow">and</span> <span class="n">rec_dict</span><span class="p">[</span><span class="n">id_attr</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">}</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="o">**</span><span class="n">rec_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">nwb_objs</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.RawPosition" class="doc doc-heading">
        <code>RawPosition</code>


<a href="#src.spyglass.position.v1.position_dlc_centroid.RawPosition" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Imported">Imported</span></code></p>

  
      <h4 id="src.spyglass.position.v1.position_dlc_centroid.RawPosition--notes">Notes<a class="headerlink" href="#src.spyglass.position.v1.position_dlc_centroid.RawPosition--notes" title="Permanent link">&para;</a></h4>
<p>The position timestamps come from: .pos_cameraHWSync.dat.
If PTP is not used, the position timestamps are inferred by finding the
closest timestamps from the neural recording via the trodes time.</p>


        <details class="quote">
          <summary>Source code in <code>src/spyglass/common/common_behav.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">RawPosition</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Imported</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The position timestamps come from: .pos_cameraHWSync.dat.</span>
<span class="sd">    If PTP is not used, the position timestamps are inferred by finding the</span>
<span class="sd">    closest timestamps from the neural recording via the trodes time.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; PositionSource</span>
<span class="s2">    ---</span>
<span class="s2">    raw_position_object_id: varchar(40)    # the object id of the spatial series for this epoch in the NWB file</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">nwb_file_name</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span>
        <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="n">nwb_file_abspath</span><span class="p">)</span>

        <span class="c1"># TODO refactor this. this calculates sampling rate (unused here) and is expensive to do twice</span>
        <span class="n">pos_dict</span> <span class="o">=</span> <span class="n">get_all_spatial_series</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">pos_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span>
                <span class="s2">&quot;interval_list_name&quot;</span>
            <span class="p">]</span> <span class="o">==</span> <span class="n">PositionSource</span><span class="o">.</span><span class="n">get_pos_interval_name</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
                <span class="n">pdict</span> <span class="o">=</span> <span class="n">pos_dict</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;raw_position_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="s2">&quot;raw_position_object_id&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">fetch_nwb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fetch_nwb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">Nwbfile</span><span class="p">,</span> <span class="s2">&quot;nwb_file_abs_path&quot;</span><span class="p">),</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch1_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw_position_nwb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_nwb</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;raw_position&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">raw_position_nwb</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">raw_position_nwb</span><span class="o">.</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">raw_position_nwb</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.AnalysisNwbfile" class="doc doc-heading">
        <code>AnalysisNwbfile</code>


<a href="#src.spyglass.position.v1.position_dlc_centroid.AnalysisNwbfile" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>



        <details class="quote">
          <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">AnalysisNwbfile</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    # Table for holding the NWB files that contain results of analysis, such as spike sorting.</span>
<span class="s2">    analysis_file_name: varchar(255)               # name of the file</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; Nwbfile                                     # name of the parent NWB file. Used for naming and metadata copy</span>
<span class="s2">    analysis_file_abs_path: filepath@analysis      # the full path to the file</span>
<span class="s2">    analysis_file_description = &quot;&quot;: varchar(2000)  # an optional description of this analysis</span>
<span class="s2">    analysis_parameters = NULL: blob               # additional relevant parameters. Currently used only for analyses</span>
<span class="s2">                                                   # that span multiple NWB files</span>
<span class="s2">    INDEX (analysis_file_abs_path)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE the INDEX above is implicit from filepath@... above but needs to be explicit</span>
    <span class="c1"># so that alter() can work</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the NWB file, create a copy, write the copy to disk and return the name of the new file.</span>

<span class="sd">        Note that this does NOT add the file to the schema; that needs to be done after data are written to it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The name of an NWB file to be copied.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the new NWB file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">nwb_file_abspath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
            <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1"># pop off the unnecessary elements to save space</span>
            <span class="n">nwb_fields</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">fields</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">nwb_fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NWB_KEEP_FIELDS</span><span class="p">:</span>
                    <span class="n">nwb_object</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">nwbf</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nwb_object</span><span class="p">,</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LabelledDict</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nwb_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="n">nwb_object</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

            <span class="n">analysis_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_new_file_name</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
            <span class="c1"># write the new file</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing new NWB file </span><span class="si">{</span><span class="n">analysis_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">analysis_file_abs_path</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="n">analysis_file_name</span>
            <span class="p">)</span>
            <span class="c1"># export the new NWB file</span>
            <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="n">analysis_file_abs_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">manager</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">export_io</span><span class="p">:</span>
                <span class="n">export_io</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">)</span>

        <span class="c1"># change the permissions to only allow owner to write</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRGRP</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IROTH</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">analysis_file_abs_path</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">analysis_file_name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_new_file_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
        <span class="c1"># each file ends with a random string of 10 digits, so we generate that string and redo if by some miracle</span>
        <span class="c1"># it&#39;s already there</span>
        <span class="n">file_in_table</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">file_in_table</span><span class="p">:</span>
            <span class="n">analysis_file_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;.nwb&quot;</span>
            <span class="p">)</span>
            <span class="n">file_in_table</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span> <span class="o">&amp;</span> <span class="p">{</span>
                <span class="s2">&quot;analysis_file_name&quot;</span><span class="p">:</span> <span class="n">analysis_file_name</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">analysis_file_name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_analysis_file_dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># strip off everything after and including the final underscore and return the result</span>
        <span class="k">return</span> <span class="n">analysis_file_name</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">analysis_file_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a copy of an analysis NWB file.</span>

<span class="sd">        Note that this does NOT add the file to the schema; that needs to be done after data are written to it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The name of the analysis NWB file to be copied.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the new NWB file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">nwb_file_abspath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
            <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1"># get the current number of analysis files related to this nwb file</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
            <span class="n">original_nwb_file_name</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">analysis_file_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__get_new_file_name</span><span class="p">(</span><span class="n">original_nwb_file_name</span><span class="p">)</span>
            <span class="c1"># write the new file</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing new NWB file </span><span class="si">{</span><span class="n">analysis_file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="n">analysis_file_abs_path</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
                <span class="n">analysis_file_name</span>
            <span class="p">)</span>
            <span class="c1"># export the new NWB file</span>
            <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="n">analysis_file_abs_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">manager</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">export_io</span><span class="p">:</span>
                <span class="n">export_io</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">analysis_file_name</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the specified file to AnalysisNWBfile table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nwb_file_name : str</span>
<span class="sd">            The name of the parent NWB file.</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the analysis NWB file that was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_file_name</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_abs_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="n">analysis_file_name</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="n">analysis_nwb_file_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the absolute path for a stored analysis NWB file given just the file name.</span>

<span class="sd">        The SPYGLASS_BASE_DIR environment variable must be set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        analysis_nwb_file_name : str</span>
<span class="sd">            The name of the NWB file that has been inserted into the AnalysisNwbfile() schema</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        analysis_nwb_file_abspath : str</span>
<span class="sd">            The absolute path for the given file name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SPYGLASS_BASE_DIR&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">base_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;You must set SPYGLASS_BASE_DIR environment variable.&quot;</span>

        <span class="c1"># see if the file exists and is stored in the base analysis dir</span>
        <span class="n">test_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">base_dir</span> <span class="o">/</span> <span class="s2">&quot;analysis&quot;</span> <span class="o">/</span> <span class="n">analysis_nwb_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">test_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">test_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use the new path</span>
            <span class="n">analysis_file_base_path</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">base_dir</span>
                <span class="o">/</span> <span class="s2">&quot;analysis&quot;</span>
                <span class="o">/</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">__get_analysis_file_dir</span><span class="p">(</span>
                    <span class="n">analysis_nwb_file_name</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">analysis_file_base_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">analysis_file_base_path</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">analysis_file_base_path</span> <span class="o">/</span> <span class="n">analysis_nwb_file_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_nwb_object</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">nwb_object</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;pandas_table&quot;</span>
    <span class="p">):</span>
        <span class="c1"># TODO: change to add_object with checks for object type and a name parameter, which should be specified if</span>
        <span class="c1"># it is not an NWB container</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an NWB object to the analysis file in the scratch area and returns the NWB object ID</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the analysis NWB file.</span>
<span class="sd">        nwb_object : pynwb.core.NWBDataInterface</span>
<span class="sd">            The NWB object created by PyNWB.</span>
<span class="sd">        table_name : str (optional, defaults to &#39;pandas_table&#39;)</span>
<span class="sd">            The name of the DynamicTable made from a dataframe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nwb_object_id : str</span>
<span class="sd">            The NWB object ID of the added object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
            <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nwb_object</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">dt_object</span> <span class="o">=</span> <span class="n">DynamicTable</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">nwb_object</span>
                <span class="p">)</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_scratch</span><span class="p">(</span><span class="n">dt_object</span><span class="p">)</span>
                <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">dt_object</span><span class="o">.</span><span class="n">object_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_scratch</span><span class="p">(</span><span class="n">nwb_object</span><span class="p">)</span>
                <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">nwb_object</span><span class="o">.</span><span class="n">object_id</span>

    <span class="k">def</span> <span class="nf">add_units</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">analysis_file_name</span><span class="p">,</span>
        <span class="n">units</span><span class="p">,</span>
        <span class="n">units_valid_times</span><span class="p">,</span>
        <span class="n">units_sort_interval</span><span class="p">,</span>
        <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">units_waveforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add units to analysis NWB file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the analysis NWB file.</span>
<span class="sd">        units : dict</span>
<span class="sd">            keys are unit ids, values are spike times</span>
<span class="sd">        units_valid_times : dict</span>
<span class="sd">            Dictionary of units and valid times with unit ids as keys.</span>
<span class="sd">        units_sort_interval : dict</span>
<span class="sd">            Dictionary of units and sort_interval with unit ids as keys.</span>
<span class="sd">        units_waveforms : dict, optional</span>
<span class="sd">            Dictionary of unit waveforms with unit ids as keys.</span>
<span class="sd">        metrics : dict, optional</span>
<span class="sd">            Cluster metrics.</span>
<span class="sd">        labels : dict, optional</span>
<span class="sd">            Curation labels for clusters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        units_object_id, waveforms_object_id : str, str</span>
<span class="sd">            The NWB object id of the Units object and the object id of the waveforms object (&#39;&#39; if None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
            <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">sort_intervals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="c1"># Add spike times and valid time range for the sort</span>
                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">units</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit</span><span class="p">(</span>
                        <span class="n">spike_times</span><span class="o">=</span><span class="n">units</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span>
                        <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                        <span class="c1"># waveform_mean = units_templates[id],</span>
                        <span class="n">obs_intervals</span><span class="o">=</span><span class="n">units_valid_times</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">sort_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">units_sort_interval</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span>
                <span class="c1"># Add a column for the sort interval (subset of valid time)</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sort_interval&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;the interval used for spike sorting&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">sort_intervals</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># If metrics were specified, add one column per metric</span>
                <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="n">metric</span><span class="p">]:</span>
                            <span class="n">unit_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                            <span class="n">metric_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                <span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                            <span class="p">)</span>
                            <span class="c1"># sort by unit_ids and apply that sorting to values to ensure that things go in the right order</span>
                            <span class="n">metric_values</span> <span class="o">=</span> <span class="n">metric_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">unit_ids</span><span class="p">)]</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">metric_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                                <span class="n">name</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric&quot;</span><span class="p">,</span>
                                <span class="n">data</span><span class="o">=</span><span class="n">metric_values</span><span class="p">,</span>
                            <span class="p">)</span>
                <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">unit_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">unit_ids</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                            <span class="n">labels</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">label_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                    <span class="n">label_values</span> <span class="o">=</span> <span class="n">label_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">unit_ids</span><span class="p">)]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;label given during curation&quot;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">label_values</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="c1"># If the waveforms were specified, add them as a dataframe to scratch</span>
                <span class="n">waveforms_object_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">units_waveforms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">waveforms_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                        <span class="n">units_waveforms</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span>
                    <span class="p">)</span>
                    <span class="n">waveforms_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveforms&quot;</span><span class="p">]</span>
                    <span class="n">nwbf</span><span class="o">.</span><span class="n">add_scratch</span><span class="p">(</span>
                        <span class="n">waveforms_df</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;units_waveforms&quot;</span><span class="p">,</span>
                        <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;spike waveforms for each unit&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">waveforms_object_id</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">scratch</span><span class="p">[</span>
                        <span class="s2">&quot;units_waveforms&quot;</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">object_id</span>

                <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span> <span class="n">waveforms_object_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">add_units_waveforms</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">analysis_file_name</span><span class="p">,</span>
        <span class="n">waveform_extractor</span><span class="p">:</span> <span class="n">si</span><span class="o">.</span><span class="n">WaveformExtractor</span><span class="p">,</span>
        <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add units to analysis NWB file along with the waveforms</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the analysis NWB file.</span>
<span class="sd">        waveform_extractor : si.WaveformExtractor object</span>
<span class="sd">        metrics : dict, optional</span>
<span class="sd">            Cluster metrics.</span>
<span class="sd">        labels : dict, optional</span>
<span class="sd">            Curation labels for clusters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        units_object_id : str</span>
<span class="sd">            The NWB object id of the Units object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
            <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">waveform_extractor</span><span class="o">.</span><span class="n">sorting</span><span class="o">.</span><span class="n">get_unit_ids</span><span class="p">():</span>
                <span class="c1"># (spikes, samples, channels)</span>
                <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveform_extractor</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">unit_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
                <span class="c1"># (channels, spikes, samples)</span>
                <span class="n">waveforms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit</span><span class="p">(</span>
                    <span class="n">spike_times</span><span class="o">=</span><span class="n">waveform_extractor</span><span class="o">.</span><span class="n">sorting</span><span class="o">.</span><span class="n">get_unit_spike_train</span><span class="p">(</span>
                        <span class="n">unit_id</span><span class="o">=</span><span class="nb">id</span>
                    <span class="p">),</span>
                    <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                    <span class="n">electrodes</span><span class="o">=</span><span class="n">waveform_extractor</span><span class="o">.</span><span class="n">recording</span><span class="o">.</span><span class="n">get_channel_ids</span><span class="p">(),</span>
                    <span class="n">waveforms</span><span class="o">=</span><span class="n">waveforms</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># The following is a rough sketch of AnalysisNwbfile().add_waveforms</span>
            <span class="c1"># analysis_file_name = AnalysisNwbfile().create(key[&#39;nwb_file_name&#39;])</span>
            <span class="c1"># or</span>
            <span class="c1"># nwbfile = pynwb.NWBFile(...)</span>
            <span class="c1"># (channels, spikes, samples)</span>
            <span class="c1"># wfs = [</span>
            <span class="c1">#         [     # elec 1</span>
            <span class="c1">#             [1, 2, 3],  # spike 1, [sample 1, sample 2, sample 3]</span>
            <span class="c1">#             [1, 2, 3],  # spike 2</span>
            <span class="c1">#             [1, 2, 3],  # spike 3</span>
            <span class="c1">#             [1, 2, 3]   # spike 4</span>
            <span class="c1">#         ], [  # elec 2</span>
            <span class="c1">#             [1, 2, 3],  # spike 1</span>
            <span class="c1">#             [1, 2, 3],  # spike 2</span>
            <span class="c1">#             [1, 2, 3],  # spike 3</span>
            <span class="c1">#             [1, 2, 3]   # spike 4</span>
            <span class="c1">#         ], [  # elec 3</span>
            <span class="c1">#             [1, 2, 3],  # spike 1</span>
            <span class="c1">#             [1, 2, 3],  # spike 2</span>
            <span class="c1">#             [1, 2, 3],  # spike 3</span>
            <span class="c1">#             [1, 2, 3]   # spike 4</span>
            <span class="c1">#         ]</span>
            <span class="c1"># ]</span>
            <span class="c1"># elecs = ... # DynamicTableRegion referring to three electrodes (rows) of the electrodes table</span>
            <span class="c1"># nwbfile.add_unit(spike_times=[1, 2, 3], electrodes=elecs, waveforms=wfs)</span>

            <span class="c1"># If metrics were specified, add one column per metric</span>
            <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_dict</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">metric_dict</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metric_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                    <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">metric_data</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;label given during curation&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">object_id</span>

    <span class="k">def</span> <span class="nf">add_units_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add units to analysis NWB file along with the waveforms</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the analysis NWB file.</span>
<span class="sd">        metrics : dict, optional</span>
<span class="sd">            Cluster metrics.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        units_object_id : str</span>
<span class="sd">            The NWB object id of the Units object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metric_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">unit_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="n">metric_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
            <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">unit_ids</span><span class="p">:</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_dict</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">metric_dict</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">metric_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metric_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">metric_data</span>
                <span class="p">)</span>

            <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">object_id</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_electrode_indices</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">electrode_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given an analysis NWB file name, returns the indices of the specified electrode_ids.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        analysis_file_name : str</span>
<span class="sd">            The name of the analysis NWB file.</span>
<span class="sd">        electrode_ids : numpy array or list</span>
<span class="sd">            Array or list of electrode IDs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        electrode_indices : numpy array</span>
<span class="sd">            Array of indices in the electrodes table for the given electrode IDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">get_electrode_indices</span><span class="p">(</span><span class="n">nwbf</span><span class="o">.</span><span class="n">electrodes</span><span class="p">,</span> <span class="n">electrode_ids</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">delete_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the filepath entries for NWB files that are not in use.</span>

<span class="sd">        Does not delete the files themselves unless delete_files=True is specified.</span>
<span class="sd">        Run this after deleting the Nwbfile() entries themselves.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        delete_files : bool, optional</span>
<span class="sd">            Whether the original files should be deleted (default False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="s2">&quot;analysis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_external_files</span><span class="o">=</span><span class="n">delete_files</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">nightly_cleanup</span><span class="p">():</span>
        <span class="n">child_tables</span> <span class="o">=</span> <span class="n">get_child_tables</span><span class="p">(</span><span class="n">AnalysisNwbfile</span><span class="p">)</span>
        <span class="p">(</span><span class="n">AnalysisNwbfile</span> <span class="o">-</span> <span class="n">child_tables</span><span class="p">)</span><span class="o">.</span><span class="n">delete_quick</span><span class="p">()</span>

        <span class="c1"># a separate external files clean up required - this is to be done</span>
        <span class="c1"># during times when no other transactions are in progress.</span>
        <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">cleanup</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.create" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span></code>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.create" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Open the NWB file, create a copy, write the copy to disk and return the name of the new file.</p>
<p>Note that this does NOT add the file to the schema; that needs to be done after data are written to it.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of an NWB file to be copied.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>analysis_file_name</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the new NWB file.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open the NWB file, create a copy, write the copy to disk and return the name of the new file.</span>

<span class="sd">    Note that this does NOT add the file to the schema; that needs to be done after data are written to it.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The name of an NWB file to be copied.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the new NWB file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">Nwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="n">nwb_file_abspath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c1"># pop off the unnecessary elements to save space</span>
        <span class="n">nwb_fields</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">fields</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">nwb_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NWB_KEEP_FIELDS</span><span class="p">:</span>
                <span class="n">nwb_object</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">nwbf</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nwb_object</span><span class="p">,</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LabelledDict</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">nwb_object</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="n">nwb_object</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>

        <span class="n">analysis_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_new_file_name</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
        <span class="c1"># write the new file</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing new NWB file </span><span class="si">{</span><span class="n">analysis_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">analysis_file_abs_path</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="n">analysis_file_name</span>
        <span class="p">)</span>
        <span class="c1"># export the new NWB file</span>
        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">analysis_file_abs_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">manager</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">export_io</span><span class="p">:</span>
            <span class="n">export_io</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">)</span>

    <span class="c1"># change the permissions to only allow owner to write</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRGRP</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IROTH</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">analysis_file_abs_path</span><span class="p">,</span> <span class="n">permissions</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">analysis_file_name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.copy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">copy</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.copy" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Make a copy of an analysis NWB file.</p>
<p>Note that this does NOT add the file to the schema; that needs to be done after data are written to it.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the analysis NWB file to be copied.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>analysis_file_name</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the new NWB file.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a copy of an analysis NWB file.</span>

<span class="sd">    Note that this does NOT add the file to the schema; that needs to be done after data are written to it.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The name of the analysis NWB file to be copied.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the new NWB file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nwb_file_abspath</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="n">nwb_file_abspath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c1"># get the current number of analysis files related to this nwb file</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span> <span class="o">&amp;</span> <span class="p">{</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">:</span> <span class="n">nwb_file_name</span><span class="p">}</span>
        <span class="n">original_nwb_file_name</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">analysis_file_name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__get_new_file_name</span><span class="p">(</span><span class="n">original_nwb_file_name</span><span class="p">)</span>
        <span class="c1"># write the new file</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing new NWB file </span><span class="si">{</span><span class="n">analysis_file_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">analysis_file_abs_path</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="n">analysis_file_name</span>
        <span class="p">)</span>
        <span class="c1"># export the new NWB file</span>
        <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">analysis_file_abs_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">manager</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">export_io</span><span class="p">:</span>
            <span class="n">export_io</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">nwbf</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">analysis_file_name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.add" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">)</span></code>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Add the specified file to AnalysisNWBfile table.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the parent NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>analysis_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the analysis NWB file that was created.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nwb_file_name</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add the specified file to AnalysisNWBfile table.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nwb_file_name : str</span>
<span class="sd">        The name of the parent NWB file.</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the analysis NWB file that was created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_file_name</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis_file_name</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_abs_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
        <span class="n">analysis_file_name</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.get_abs_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_nwb_file_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.get_abs_path" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Return the absolute path for a stored analysis NWB file given just the file name.</p>
<p>The SPYGLASS_BASE_DIR environment variable must be set.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>analysis_nwb_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the NWB file that has been inserted into the AnalysisNwbfile() schema</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>analysis_nwb_file_abspath</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The absolute path for the given file name.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="n">analysis_nwb_file_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the absolute path for a stored analysis NWB file given just the file name.</span>

<span class="sd">    The SPYGLASS_BASE_DIR environment variable must be set.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    analysis_nwb_file_name : str</span>
<span class="sd">        The name of the NWB file that has been inserted into the AnalysisNwbfile() schema</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    analysis_nwb_file_abspath : str</span>
<span class="sd">        The absolute path for the given file name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SPYGLASS_BASE_DIR&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">base_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">),</span> <span class="s2">&quot;You must set SPYGLASS_BASE_DIR environment variable.&quot;</span>

    <span class="c1"># see if the file exists and is stored in the base analysis dir</span>
    <span class="n">test_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">base_dir</span> <span class="o">/</span> <span class="s2">&quot;analysis&quot;</span> <span class="o">/</span> <span class="n">analysis_nwb_file_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">test_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">test_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use the new path</span>
        <span class="n">analysis_file_base_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">base_dir</span>
            <span class="o">/</span> <span class="s2">&quot;analysis&quot;</span>
            <span class="o">/</span> <span class="n">AnalysisNwbfile</span><span class="o">.</span><span class="n">__get_analysis_file_dir</span><span class="p">(</span>
                <span class="n">analysis_nwb_file_name</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">analysis_file_base_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">analysis_file_base_path</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">analysis_file_base_path</span> <span class="o">/</span> <span class="n">analysis_nwb_file_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_nwb_object" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_nwb_object</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">nwb_object</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;pandas_table&#39;</span><span class="p">)</span></code>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_nwb_object" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Add an NWB object to the analysis file in the scratch area and returns the NWB object ID</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>analysis_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the analysis NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nwb_object</code></td>
          <td>
                <code>pynwb.<span title="pynwb.core">core</span>.<span title="pynwb.core.NWBDataInterface">NWBDataInterface</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The NWB object created by PyNWB.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>table_name</code></td>
          <td>
                <code>str (optional, defaults to &#39;pandas_table&#39;)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the DynamicTable made from a dataframe.</p>
            </div>
          </td>
          <td>
                <code>&#39;pandas_table&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>nwb_object_id</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The NWB object ID of the added object.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_nwb_object</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">nwb_object</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;pandas_table&quot;</span>
<span class="p">):</span>
    <span class="c1"># TODO: change to add_object with checks for object type and a name parameter, which should be specified if</span>
    <span class="c1"># it is not an NWB container</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an NWB object to the analysis file in the scratch area and returns the NWB object ID</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the analysis NWB file.</span>
<span class="sd">    nwb_object : pynwb.core.NWBDataInterface</span>
<span class="sd">        The NWB object created by PyNWB.</span>
<span class="sd">    table_name : str (optional, defaults to &#39;pandas_table&#39;)</span>
<span class="sd">        The name of the DynamicTable made from a dataframe.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nwb_object_id : str</span>
<span class="sd">        The NWB object ID of the added object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nwb_object</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">dt_object</span> <span class="o">=</span> <span class="n">DynamicTable</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">nwb_object</span>
            <span class="p">)</span>
            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_scratch</span><span class="p">(</span><span class="n">dt_object</span><span class="p">)</span>
            <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dt_object</span><span class="o">.</span><span class="n">object_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_scratch</span><span class="p">(</span><span class="n">nwb_object</span><span class="p">)</span>
            <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nwb_object</span><span class="o">.</span><span class="n">object_id</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_units</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">units_valid_times</span><span class="p">,</span> <span class="n">units_sort_interval</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units_waveforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Add units to analysis NWB file</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>analysis_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the analysis NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>units</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>keys are unit ids, values are spike times</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>units_valid_times</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary of units and valid times with unit ids as keys.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>units_sort_interval</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary of units and sort_interval with unit ids as keys.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>units_waveforms</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary of unit waveforms with unit ids as keys.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metrics</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cluster metrics.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Curation labels for clusters</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>units_object_id, waveforms_object_id : str, str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The NWB object id of the Units object and the object id of the waveforms object ('' if None)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_units</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">analysis_file_name</span><span class="p">,</span>
    <span class="n">units</span><span class="p">,</span>
    <span class="n">units_valid_times</span><span class="p">,</span>
    <span class="n">units_sort_interval</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">units_waveforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add units to analysis NWB file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the analysis NWB file.</span>
<span class="sd">    units : dict</span>
<span class="sd">        keys are unit ids, values are spike times</span>
<span class="sd">    units_valid_times : dict</span>
<span class="sd">        Dictionary of units and valid times with unit ids as keys.</span>
<span class="sd">    units_sort_interval : dict</span>
<span class="sd">        Dictionary of units and sort_interval with unit ids as keys.</span>
<span class="sd">    units_waveforms : dict, optional</span>
<span class="sd">        Dictionary of unit waveforms with unit ids as keys.</span>
<span class="sd">    metrics : dict, optional</span>
<span class="sd">        Cluster metrics.</span>
<span class="sd">    labels : dict, optional</span>
<span class="sd">        Curation labels for clusters</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    units_object_id, waveforms_object_id : str, str</span>
<span class="sd">        The NWB object id of the Units object and the object id of the waveforms object (&#39;&#39; if None)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">sort_intervals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># Add spike times and valid time range for the sort</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">units</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit</span><span class="p">(</span>
                    <span class="n">spike_times</span><span class="o">=</span><span class="n">units</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span>
                    <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                    <span class="c1"># waveform_mean = units_templates[id],</span>
                    <span class="n">obs_intervals</span><span class="o">=</span><span class="n">units_valid_times</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">sort_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">units_sort_interval</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span>
            <span class="c1"># Add a column for the sort interval (subset of valid time)</span>
            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sort_interval&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;the interval used for spike sorting&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">sort_intervals</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># If metrics were specified, add one column per metric</span>
            <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="n">metric</span><span class="p">]:</span>
                        <span class="n">unit_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                        <span class="n">metric_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="p">)</span>
                        <span class="c1"># sort by unit_ids and apply that sorting to values to ensure that things go in the right order</span>
                        <span class="n">metric_values</span> <span class="o">=</span> <span class="n">metric_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">unit_ids</span><span class="p">)]</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">metric_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric&quot;</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="n">metric_values</span><span class="p">,</span>
                        <span class="p">)</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">unit_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">unit_ids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                        <span class="n">labels</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">label_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="n">label_values</span> <span class="o">=</span> <span class="n">label_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">unit_ids</span><span class="p">)]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;label given during curation&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">label_values</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># If the waveforms were specified, add them as a dataframe to scratch</span>
            <span class="n">waveforms_object_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">units_waveforms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">waveforms_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                    <span class="n">units_waveforms</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span>
                <span class="p">)</span>
                <span class="n">waveforms_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveforms&quot;</span><span class="p">]</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_scratch</span><span class="p">(</span>
                    <span class="n">waveforms_df</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;units_waveforms&quot;</span><span class="p">,</span>
                    <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;spike waveforms for each unit&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">waveforms_object_id</span> <span class="o">=</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">scratch</span><span class="p">[</span>
                    <span class="s2">&quot;units_waveforms&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">object_id</span>

            <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span> <span class="n">waveforms_object_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units_waveforms" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_units_waveforms</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">waveform_extractor</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units_waveforms" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Add units to analysis NWB file along with the waveforms</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>analysis_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the analysis NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>waveform_extractor</code></td>
          <td>
                <code>si.WaveformExtractor object</code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metrics</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cluster metrics.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Curation labels for clusters</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>units_object_id</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The NWB object id of the Units object</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_units_waveforms</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">analysis_file_name</span><span class="p">,</span>
    <span class="n">waveform_extractor</span><span class="p">:</span> <span class="n">si</span><span class="o">.</span><span class="n">WaveformExtractor</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add units to analysis NWB file along with the waveforms</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the analysis NWB file.</span>
<span class="sd">    waveform_extractor : si.WaveformExtractor object</span>
<span class="sd">    metrics : dict, optional</span>
<span class="sd">        Cluster metrics.</span>
<span class="sd">    labels : dict, optional</span>
<span class="sd">        Curation labels for clusters</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    units_object_id : str</span>
<span class="sd">        The NWB object id of the Units object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">waveform_extractor</span><span class="o">.</span><span class="n">sorting</span><span class="o">.</span><span class="n">get_unit_ids</span><span class="p">():</span>
            <span class="c1"># (spikes, samples, channels)</span>
            <span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveform_extractor</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">unit_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
            <span class="c1"># (channels, spikes, samples)</span>
            <span class="n">waveforms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">waveforms</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit</span><span class="p">(</span>
                <span class="n">spike_times</span><span class="o">=</span><span class="n">waveform_extractor</span><span class="o">.</span><span class="n">sorting</span><span class="o">.</span><span class="n">get_unit_spike_train</span><span class="p">(</span>
                    <span class="n">unit_id</span><span class="o">=</span><span class="nb">id</span>
                <span class="p">),</span>
                <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                <span class="n">electrodes</span><span class="o">=</span><span class="n">waveform_extractor</span><span class="o">.</span><span class="n">recording</span><span class="o">.</span><span class="n">get_channel_ids</span><span class="p">(),</span>
                <span class="n">waveforms</span><span class="o">=</span><span class="n">waveforms</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># The following is a rough sketch of AnalysisNwbfile().add_waveforms</span>
        <span class="c1"># analysis_file_name = AnalysisNwbfile().create(key[&#39;nwb_file_name&#39;])</span>
        <span class="c1"># or</span>
        <span class="c1"># nwbfile = pynwb.NWBFile(...)</span>
        <span class="c1"># (channels, spikes, samples)</span>
        <span class="c1"># wfs = [</span>
        <span class="c1">#         [     # elec 1</span>
        <span class="c1">#             [1, 2, 3],  # spike 1, [sample 1, sample 2, sample 3]</span>
        <span class="c1">#             [1, 2, 3],  # spike 2</span>
        <span class="c1">#             [1, 2, 3],  # spike 3</span>
        <span class="c1">#             [1, 2, 3]   # spike 4</span>
        <span class="c1">#         ], [  # elec 2</span>
        <span class="c1">#             [1, 2, 3],  # spike 1</span>
        <span class="c1">#             [1, 2, 3],  # spike 2</span>
        <span class="c1">#             [1, 2, 3],  # spike 3</span>
        <span class="c1">#             [1, 2, 3]   # spike 4</span>
        <span class="c1">#         ], [  # elec 3</span>
        <span class="c1">#             [1, 2, 3],  # spike 1</span>
        <span class="c1">#             [1, 2, 3],  # spike 2</span>
        <span class="c1">#             [1, 2, 3],  # spike 3</span>
        <span class="c1">#             [1, 2, 3]   # spike 4</span>
        <span class="c1">#         ]</span>
        <span class="c1"># ]</span>
        <span class="c1"># elecs = ... # DynamicTableRegion referring to three electrodes (rows) of the electrodes table</span>
        <span class="c1"># nwbfile.add_unit(spike_times=[1, 2, 3], electrodes=elecs, waveforms=wfs)</span>

        <span class="c1"># If metrics were specified, add one column per metric</span>
        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_dict</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">metric_dict</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metric_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">metric_data</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;label given during curation&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">object_id</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units_metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_units_metrics</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span></code>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.add_units_metrics" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Add units to analysis NWB file along with the waveforms</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>analysis_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the analysis NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metrics</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cluster metrics.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>units_object_id</code></td>          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The NWB object id of the Units object</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_units_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add units to analysis NWB file along with the waveforms</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the analysis NWB file.</span>
<span class="sd">    metrics : dict, optional</span>
<span class="sd">        Cluster metrics.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    units_object_id : str</span>
<span class="sd">        The NWB object id of the Units object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metric_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">unit_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="n">metric_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">NWBHDF5IO</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">),</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
        <span class="n">nwbf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">unit_ids</span><span class="p">:</span>
            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_dict</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">metric_dict</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">metric_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metric_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">nwbf</span><span class="o">.</span><span class="n">add_unit_column</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">metric_data</span>
            <span class="p">)</span>

        <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwbf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nwbf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">object_id</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.get_electrode_indices" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_electrode_indices</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">electrode_ids</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.get_electrode_indices" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Given an analysis NWB file name, returns the indices of the specified electrode_ids.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>analysis_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the analysis NWB file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>electrode_ids</code></td>
          <td>
                <code>numpy array or list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array or list of electrode IDs.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>electrode_indices</code></td>          <td>
                <code>numpy array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of indices in the electrodes table for the given electrode IDs.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_electrode_indices</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">analysis_file_name</span><span class="p">,</span> <span class="n">electrode_ids</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given an analysis NWB file name, returns the indices of the specified electrode_ids.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    analysis_file_name : str</span>
<span class="sd">        The name of the analysis NWB file.</span>
<span class="sd">    electrode_ids : numpy array or list</span>
<span class="sd">        Array or list of electrode IDs.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    electrode_indices : numpy array</span>
<span class="sd">        Array of indices in the electrodes table for the given electrode IDs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nwbf</span> <span class="o">=</span> <span class="n">get_nwb_file</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">analysis_file_name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">get_electrode_indices</span><span class="p">(</span><span class="n">nwbf</span><span class="o">.</span><span class="n">electrodes</span><span class="p">,</span> <span class="n">electrode_ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="src.spyglass.common.common_nwbfile.AnalysisNwbfile.cleanup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cleanup</span><span class="p">(</span><span class="n">delete_files</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.spyglass.common.common_nwbfile.AnalysisNwbfile.cleanup" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Remove the filepath entries for NWB files that are not in use.</p>
<p>Does not delete the files themselves unless delete_files=True is specified.
Run this after deleting the Nwbfile() entries themselves.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>delete_files</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the original files should be deleted (default False).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/common/common_nwbfile.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">delete_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the filepath entries for NWB files that are not in use.</span>

<span class="sd">    Does not delete the files themselves unless delete_files=True is specified.</span>
<span class="sd">    Run this after deleting the Nwbfile() entries themselves.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    delete_files : bool, optional</span>
<span class="sd">        Whether the original files should be deleted (default False).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">external</span><span class="p">[</span><span class="s2">&quot;analysis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_external_files</span><span class="o">=</span><span class="n">delete_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.DLCCentroidSelection" class="doc doc-heading">
        <code>DLCCentroidSelection</code>


<a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroidSelection" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>

  
      <p>Table to pair a cohort of bodypart entries with
the parameters for calculating their centroid</p>


        <details class="quote">
          <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">DLCCentroidSelection</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Table to pair a cohort of bodypart entries with</span>
<span class="sd">    the parameters for calculating their centroid</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; DLCSmoothInterpCohort</span>
<span class="s2">    -&gt; DLCCentroidParams</span>
<span class="s2">    ---</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.DLCCentroid" class="doc doc-heading">
        <code>DLCCentroid</code>


<a href="#src.spyglass.position.v1.position_dlc_centroid.DLCCentroid" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Computed">Computed</span></code></p>

  
      <p>Table to calculate the centroid of a group of bodyparts</p>


        <details class="quote">
          <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">DLCCentroid</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Computed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Table to calculate the centroid of a group of bodyparts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; DLCCentroidSelection</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; AnalysisNwbfile</span>
<span class="s2">    dlc_position_object_id : varchar(80)</span>
<span class="s2">    dlc_velocity_object_id : varchar(80)</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.dlc_utils</span> <span class="kn">import</span> <span class="n">OutputLogger</span><span class="p">,</span> <span class="n">infer_output_dir</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">infer_output_dir</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">makedir</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OutputLogger</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;nwb_file_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;dlc_model_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_log&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">}</span><span class="s2">/log.log&quot;</span><span class="p">,</span>
            <span class="n">print_console</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-----------------------&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Centroid Calculation&quot;</span><span class="p">)</span>
            <span class="c1"># Get labels to smooth from Parameters table</span>
            <span class="n">cohort_entries</span> <span class="o">=</span> <span class="n">DLCSmoothInterpCohort</span><span class="o">.</span><span class="n">BodyPart</span> <span class="o">&amp;</span> <span class="n">key</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">DLCCentroidParams</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">)</span>
            <span class="n">centroid_method</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;centroid_method&quot;</span><span class="p">)</span>
            <span class="n">bodyparts_avail</span> <span class="o">=</span> <span class="n">cohort_entries</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;bodypart&quot;</span><span class="p">)</span>
            <span class="n">speed_smoothing_std_dev</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;speed_smoothing_std_dev&quot;</span><span class="p">)</span>
            <span class="c1"># TODO, generalize key naming</span>
            <span class="k">if</span> <span class="n">centroid_method</span> <span class="o">==</span> <span class="s2">&quot;four_led_centroid&quot;</span><span class="p">:</span>
                <span class="n">centroid_func</span> <span class="o">=</span> <span class="n">_key_to_func_dict</span><span class="p">[</span><span class="n">centroid_method</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;greenLED&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;greenLED&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bodyparts_avail</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;greenLED&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> not a bodypart used in this model&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;A green led needs to be specified for the 4 led centroid method&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;redLED_L&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_L&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bodyparts_avail</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_L&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> not a bodypart used in this model&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;A left red led needs to be specified for the 4 led centroid method&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;redLED_C&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_C&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bodyparts_avail</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_C&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> not a bodypart used in this model&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;A center red led needs to be specified for the 4 led centroid method&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;redLED_R&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_R&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bodyparts_avail</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_R&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> not a bodypart used in this model&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;A right red led needs to be specified for the 4 led centroid method&quot;</span>
                    <span class="p">)</span>
                <span class="n">bodyparts_to_use</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;greenLED&quot;</span><span class="p">],</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_L&quot;</span><span class="p">],</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_C&quot;</span><span class="p">],</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;redLED_R&quot;</span><span class="p">],</span>
                <span class="p">]</span>

            <span class="k">elif</span> <span class="n">centroid_method</span> <span class="o">==</span> <span class="s2">&quot;two_pt_centroid&quot;</span><span class="p">:</span>
                <span class="n">centroid_func</span> <span class="o">=</span> <span class="n">_key_to_func_dict</span><span class="p">[</span><span class="n">centroid_method</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;point1&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point1&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bodyparts_avail</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point1&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> not a bodypart used in this model&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;point1 needs to be specified for the 2 pt centroid method&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;point2&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point2&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bodyparts_avail</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point2&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> not a bodypart used in this model&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;point2 needs to be specified for the 2 pt centroid method&quot;</span>
                    <span class="p">)</span>
                <span class="n">bodyparts_to_use</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point1&quot;</span><span class="p">],</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point2&quot;</span><span class="p">],</span>
                <span class="p">]</span>

            <span class="k">elif</span> <span class="n">centroid_method</span> <span class="o">==</span> <span class="s2">&quot;one_pt_centroid&quot;</span><span class="p">:</span>
                <span class="n">centroid_func</span> <span class="o">=</span> <span class="n">_key_to_func_dict</span><span class="p">[</span><span class="n">centroid_method</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;point1&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point1&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">bodyparts_avail</span>
                    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point1&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> not a bodypart used in this model&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;point1 needs to be specified for the 1 pt centroid method&quot;</span>
                    <span class="p">)</span>
                <span class="n">bodyparts_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">][</span><span class="s2">&quot;point1&quot;</span><span class="p">]]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please specify a centroid method to use.&quot;</span><span class="p">)</span>
            <span class="n">pos_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">bodypart</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">DLCSmoothInterpCohort</span><span class="o">.</span><span class="n">BodyPart</span>
                        <span class="o">&amp;</span> <span class="p">{</span><span class="o">**</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;bodypart&quot;</span><span class="p">:</span> <span class="n">bodypart</span><span class="p">}}</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">fetch1_dataframe</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">bodypart</span> <span class="ow">in</span> <span class="n">bodyparts_to_use</span>
                <span class="p">},</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pos_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
            <span class="n">sampling_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">dt</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Calculating centroid with </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">centroid_method</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="n">centroid_func</span><span class="p">(</span><span class="n">pos_df</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
            <span class="n">centroid_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">centroid</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span>
                <span class="n">index</span><span class="o">=</span><span class="n">pos_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;interpolate&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">centroid</span><span class="p">)):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;interpolating over NaNs&quot;</span><span class="p">)</span>
                    <span class="n">nan_inds</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">centroid_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]])</span>
                        <span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">nan_spans</span> <span class="o">=</span> <span class="n">get_span_start_stop</span><span class="p">(</span><span class="n">nan_inds</span><span class="p">)</span>
                    <span class="n">interp_df</span> <span class="o">=</span> <span class="n">interp_pos</span><span class="p">(</span>
                        <span class="n">centroid_df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">nan_spans</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;interp_params&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;no NaNs to interpolate over&quot;</span><span class="p">)</span>
                    <span class="n">interp_df</span> <span class="o">=</span> <span class="n">centroid_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interp_df</span> <span class="o">=</span> <span class="n">centroid_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smooth&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s2">&quot;smoothing_duration&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]:</span>
                    <span class="n">smoothing_duration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
                        <span class="s2">&quot;smoothing_duration&quot;</span>
                    <span class="p">)</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pos_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()))</span>
                    <span class="n">sampling_rate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">dt</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;smoothing position&quot;</span><span class="p">)</span>
                    <span class="n">smooth_func</span> <span class="o">=</span> <span class="n">_key_to_smooth_func_dict</span><span class="p">[</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span><span class="s2">&quot;smooth_method&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Smoothing using method: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">][</span><span class="s2">&quot;smooth_method&quot;</span><span class="p">]),</span>
                    <span class="p">)</span>
                    <span class="n">final_df</span> <span class="o">=</span> <span class="n">smooth_func</span><span class="p">(</span>
                        <span class="n">interp_df</span><span class="p">,</span>
                        <span class="n">smoothing_duration</span><span class="o">=</span><span class="n">smoothing_duration</span><span class="p">,</span>
                        <span class="n">sampling_rate</span><span class="o">=</span><span class="n">sampling_rate</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;smoothing_params&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s2">&quot;smoothing_duration needs to be passed within smoothing_params&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">final_df</span> <span class="o">=</span> <span class="n">interp_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;getting velocity&quot;</span><span class="p">)</span>
            <span class="n">velocity</span> <span class="o">=</span> <span class="n">get_velocity</span><span class="p">(</span>
                <span class="n">final_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">time</span><span class="o">=</span><span class="n">pos_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">sigma</span><span class="o">=</span><span class="n">speed_smoothing_std_dev</span><span class="p">,</span>
                <span class="n">sampling_frequency</span><span class="o">=</span><span class="n">sampling_rate</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># cm/s</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">velocity</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># cm/s</span>
            <span class="c1"># Create dataframe</span>
            <span class="n">velocity_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">velocity</span><span class="p">,</span> <span class="n">speed</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;velocity_x&quot;</span><span class="p">,</span> <span class="s2">&quot;velocity_y&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">],</span>
                <span class="n">index</span><span class="o">=</span><span class="n">pos_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">total_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">final_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">pretrack_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">final_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;total NaNs in centroid dataset: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">total_nan</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;NaNs in centroid dataset before ind 1000: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pretrack_nan</span>
            <span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">behavior</span><span class="o">.</span><span class="n">Position</span><span class="p">()</span>
            <span class="n">velocity</span> <span class="o">=</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">behavior</span><span class="o">.</span><span class="n">BehavioralTimeSeries</span><span class="p">()</span>
            <span class="n">spatial_series</span> <span class="o">=</span> <span class="p">(</span><span class="n">RawPosition</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_nwb</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span>
                <span class="s2">&quot;raw_position&quot;</span>
            <span class="p">]</span>
            <span class="n">METERS_PER_CM</span> <span class="o">=</span> <span class="mf">0.01</span>
            <span class="n">position</span><span class="o">.</span><span class="n">create_spatial_series</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
                <span class="n">timestamps</span><span class="o">=</span><span class="n">final_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">conversion</span><span class="o">=</span><span class="n">METERS_PER_CM</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">final_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">reference_frame</span><span class="o">=</span><span class="n">spatial_series</span><span class="o">.</span><span class="n">reference_frame</span><span class="p">,</span>
                <span class="n">comments</span><span class="o">=</span><span class="n">spatial_series</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;x_position, y_position&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">velocity</span><span class="o">.</span><span class="n">create_timeseries</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;velocity&quot;</span><span class="p">,</span>
                <span class="n">timestamps</span><span class="o">=</span><span class="n">velocity_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">conversion</span><span class="o">=</span><span class="n">METERS_PER_CM</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">velocity_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="n">idx</span><span class="p">[(</span><span class="s2">&quot;velocity_x&quot;</span><span class="p">,</span> <span class="s2">&quot;velocity_y&quot;</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="p">)]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">comments</span><span class="o">=</span><span class="n">spatial_series</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;x_velocity, y_velocity, speed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">velocity</span><span class="o">.</span><span class="n">create_timeseries</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;video_frame_ind&quot;</span><span class="p">,</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span>
                <span class="n">timestamps</span><span class="o">=</span><span class="n">final_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">data</span><span class="o">=</span><span class="n">pos_df</span><span class="p">[</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">video_frame_ind</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;video_frame_ind&quot;</span><span class="p">,</span>
                <span class="n">comments</span><span class="o">=</span><span class="s2">&quot;no comments&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Add to Analysis NWB file</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">nwb_analysis_file</span> <span class="o">=</span> <span class="n">AnalysisNwbfile</span><span class="p">()</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;dlc_position_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_analysis_file</span><span class="o">.</span><span class="n">add_nwb_object</span><span class="p">(</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">],</span> <span class="n">position</span>
            <span class="p">)</span>
            <span class="n">key</span><span class="p">[</span><span class="s2">&quot;dlc_velocity_object_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nwb_analysis_file</span><span class="o">.</span><span class="n">add_nwb_object</span><span class="p">(</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">],</span> <span class="n">velocity</span>
            <span class="p">)</span>

            <span class="n">nwb_analysis_file</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">nwb_file_name</span><span class="o">=</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;nwb_file_name&quot;</span><span class="p">],</span>
                <span class="n">analysis_file_name</span><span class="o">=</span><span class="n">key</span><span class="p">[</span><span class="s2">&quot;analysis_file_name&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;inserted entry into DLCCentroid&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_nwb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fetch_nwb</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">AnalysisNwbfile</span><span class="p">,</span> <span class="s2">&quot;analysis_file_abs_path&quot;</span><span class="p">),</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch1_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nwb_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_nwb</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                <span class="n">nwb_data</span><span class="p">[</span><span class="s2">&quot;dlc_position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_spatial_series</span><span class="p">()</span><span class="o">.</span><span class="n">timestamps</span>
            <span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;video_frame_ind&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position_x&quot;</span><span class="p">,</span>
            <span class="s2">&quot;position_y&quot;</span><span class="p">,</span>
            <span class="s2">&quot;velocity_x&quot;</span><span class="p">,</span>
            <span class="s2">&quot;velocity_y&quot;</span><span class="p">,</span>
            <span class="s2">&quot;speed&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                        <span class="n">nwb_data</span><span class="p">[</span><span class="s2">&quot;dlc_velocity&quot;</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">time_series</span><span class="p">[</span><span class="s2">&quot;video_frame_ind&quot;</span><span class="p">]</span>
                        <span class="o">.</span><span class="n">data</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                    <span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                        <span class="n">nwb_data</span><span class="p">[</span><span class="s2">&quot;dlc_position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_spatial_series</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                        <span class="n">nwb_data</span><span class="p">[</span><span class="s2">&quot;dlc_velocity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">time_series</span><span class="p">[</span><span class="s2">&quot;velocity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">),</span>
                <span class="p">),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.four_led_centroid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">four_led_centroid</span><span class="p">(</span><span class="n">pos_df</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></code>

<a href="#src.spyglass.position.v1.position_dlc_centroid.four_led_centroid" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Determines the centroid of 4 LEDS on an implant LED ring.
Assumed to be the Green LED, and 3 red LEDs called: redLED_C, redLED_L, redLED_R
By default, uses (greenled + redLED_C) / 2 to calculate centroid
If Green LED is NaN, but red center LED is not,
    then the red center LED is called the centroid
If green and red center LEDs are NaN, but red left and red right LEDs are not,
    then the centroid is (redLED_L + redLED_R) / 2
If red center LED is NaN, but the other 3 LEDS are not,
    then the centroid is (greenled + (redLED_L + redLED_R) / 2) / 2
If red center and left LEDs are NaN, but green and red right LEDs are not,
    then the centroid is (greenled + redLED_R) / 2
If red center and right LEDs are NaN, but green and red left LEDs are not,
    then the centroid is (greenled + redLED_L) / 2
If all red LEDs are NaN, but green LED is not,
    then the green LED is called the centroid
If all LEDs are NaN, then the centroid is NaN</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos_df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dataframe containing x and y position for each LED of interest,
index is timestamps. Column names specified by params</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>**params</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>contains 'greenLED' and 'redLED_C', 'redLED_R', 'redLED_L' keys,
whose values specify the column names in <code>pos_df</code></p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>centroid</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>numpy array with shape (n_time, 2)
centroid[0] is the x coord and centroid[1] is the y coord</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">four_led_centroid</span><span class="p">(</span><span class="n">pos_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the centroid of 4 LEDS on an implant LED ring.</span>
<span class="sd">    Assumed to be the Green LED, and 3 red LEDs called: redLED_C, redLED_L, redLED_R</span>
<span class="sd">    By default, uses (greenled + redLED_C) / 2 to calculate centroid</span>
<span class="sd">    If Green LED is NaN, but red center LED is not,</span>
<span class="sd">        then the red center LED is called the centroid</span>
<span class="sd">    If green and red center LEDs are NaN, but red left and red right LEDs are not,</span>
<span class="sd">        then the centroid is (redLED_L + redLED_R) / 2</span>
<span class="sd">    If red center LED is NaN, but the other 3 LEDS are not,</span>
<span class="sd">        then the centroid is (greenled + (redLED_L + redLED_R) / 2) / 2</span>
<span class="sd">    If red center and left LEDs are NaN, but green and red right LEDs are not,</span>
<span class="sd">        then the centroid is (greenled + redLED_R) / 2</span>
<span class="sd">    If red center and right LEDs are NaN, but green and red left LEDs are not,</span>
<span class="sd">        then the centroid is (greenled + redLED_L) / 2</span>
<span class="sd">    If all red LEDs are NaN, but green LED is not,</span>
<span class="sd">        then the green LED is called the centroid</span>
<span class="sd">    If all LEDs are NaN, then the centroid is NaN</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos_df : pd.DataFrame</span>
<span class="sd">        dataframe containing x and y position for each LED of interest,</span>
<span class="sd">        index is timestamps. Column names specified by params</span>
<span class="sd">    **params : dict</span>
<span class="sd">        contains &#39;greenLED&#39; and &#39;redLED_C&#39;, &#39;redLED_R&#39;, &#39;redLED_L&#39; keys,</span>
<span class="sd">        whose values specify the column names in `pos_df`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    centroid : np.ndarray</span>
<span class="sd">        numpy array with shape (n_time, 2)</span>
<span class="sd">        centroid[0] is the x coord and centroid[1] is the y coord</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_df</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
    <span class="c1"># TODO: this feels messy, clean-up</span>
    <span class="n">green_led</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;greenLED&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">red_led_C</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;redLED_C&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">red_led_L</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;redLED_L&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">red_led_R</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;redLED_R&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">green_nans</span> <span class="o">=</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">red_C_nans</span> <span class="o">=</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">red_L_nans</span> <span class="o">=</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">red_R_nans</span> <span class="o">=</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># TODO: implement checks to make sure not rewriting previously set index in centroid</span>
    <span class="c1"># If all given LEDs are not NaN</span>
    <span class="n">dist_between_green_red</span> <span class="o">=</span> <span class="n">get_distance</span><span class="p">(</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">g_c_is_too_separated</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dist_between_green_red</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_LED_separation&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">all_good_mask</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="o">~</span><span class="n">green_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_C_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_L_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_R_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">g_c_is_too_separated</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">centroid</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
                <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span>
                <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># If green LED and red center LED are both not NaN</span>
    <span class="n">green_red_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
        <span class="o">~</span><span class="n">green_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">red_C_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">g_c_is_too_separated</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">green_red_C</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">green_red_C</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If all given LEDs are NaN</span>
    <span class="n">all_bad_mask</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span> <span class="p">(</span><span class="n">green_nans</span><span class="p">,</span> <span class="n">red_C_nans</span><span class="p">,</span> <span class="n">red_L_nans</span><span class="p">,</span> <span class="n">red_R_nans</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">centroid</span><span class="p">[</span><span class="n">all_bad_mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="c1"># If green LED is NaN, but red center LED is not</span>
    <span class="n">no_green_red_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">green_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">red_C_nans</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">no_green_red_C</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">no_green_red_C</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">no_green_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]],</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">no_green_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_C</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If green and red center LEDs are NaN, but red left and red right LEDs are not</span>
    <span class="n">dist_between_left_right</span> <span class="o">=</span> <span class="n">get_distance</span><span class="p">(</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">l_r_is_too_separated</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dist_between_left_right</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_LED_separation&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">no_green_no_red_C_red_L_red_R</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="n">green_nans</span><span class="p">,</span>
            <span class="n">red_C_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_L_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_R_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">l_r_is_too_separated</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">no_green_no_red_C_red_L_red_R</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">no_green_no_red_C_red_L_red_R</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">no_green_no_red_C_red_L_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">no_green_no_red_C_red_L_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">no_green_no_red_C_red_L_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">no_green_no_red_C_red_L_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If red center LED is NaN, but green, red left, and right LEDs are not</span>
    <span class="n">dist_between_left_green</span> <span class="o">=</span> <span class="n">get_distance</span><span class="p">(</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">dist_between_right_green</span> <span class="o">=</span> <span class="n">get_distance</span><span class="p">(</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">l_g_is_too_separated</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dist_between_left_green</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_LED_separation&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">r_g_is_too_separated</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dist_between_right_green</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_LED_separation&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">green_red_L_red_R_no_red_C</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="o">~</span><span class="n">green_nans</span><span class="p">,</span>
            <span class="n">red_C_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_L_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_R_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">l_r_is_too_separated</span><span class="p">,</span>
            <span class="o">~</span><span class="n">l_g_is_too_separated</span><span class="p">,</span>
            <span class="o">~</span><span class="n">r_g_is_too_separated</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
                <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span>
                <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">midpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">midpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_red_R_no_red_C</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If red center and left LED is NaN, but green and red right LED are not</span>
    <span class="n">green_red_R_no_red_C_no_red_L</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="o">~</span><span class="n">green_nans</span><span class="p">,</span>
            <span class="n">red_C_nans</span><span class="p">,</span>
            <span class="n">red_L_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_R_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">r_g_is_too_separated</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">green_red_R_no_red_C_no_red_L</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">green_red_R_no_red_C_no_red_L</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_R_no_red_C_no_red_L</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_R_no_red_C_no_red_L</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_R_no_red_C_no_red_L</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_R_no_red_C_no_red_L</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If red center and right LED is NaN, but green and red left LED are not</span>
    <span class="n">green_red_L_no_red_C_no_red_R</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="o">~</span><span class="n">green_nans</span><span class="p">,</span>
            <span class="n">red_C_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">red_L_nans</span><span class="p">,</span>
            <span class="n">red_R_nans</span><span class="p">,</span>
            <span class="o">~</span><span class="n">l_g_is_too_separated</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">green_red_L_no_red_C_no_red_R</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">green_red_L_no_red_C_no_red_R</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_no_red_C_no_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_no_red_C_no_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_no_red_C_no_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">green_red_L_no_red_C_no_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If all LEDS are NaN except red left LED</span>
    <span class="n">red_L_no_green_no_red_C_no_red_R</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span> <span class="p">(</span><span class="n">green_nans</span><span class="p">,</span> <span class="n">red_C_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">red_L_nans</span><span class="p">,</span> <span class="n">red_R_nans</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">red_L_no_green_no_red_C_no_red_R</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">red_L_no_green_no_red_C_no_red_R</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">red_L_no_green_no_red_C_no_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                <span class="p">],</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">red_L_no_green_no_red_C_no_red_R</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_L</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If all LEDS are NaN except red right LED</span>
    <span class="n">red_R_no_green_no_red_C_no_red_L</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span> <span class="p">(</span><span class="n">green_nans</span><span class="p">,</span> <span class="n">red_C_nans</span><span class="p">,</span> <span class="n">red_L_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">red_R_nans</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">red_R_no_green_no_red_C_no_red_L</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">red_R_no_green_no_red_C_no_red_L</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">red_R_no_green_no_red_C_no_red_L</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
                <span class="p">],</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">red_R_no_green_no_red_C_no_red_L</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">red_led_R</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If all red LEDs are NaN, but green LED is not</span>
    <span class="n">green_no_red</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">,</span> <span class="p">(</span><span class="o">~</span><span class="n">green_nans</span><span class="p">,</span> <span class="n">red_C_nans</span><span class="p">,</span> <span class="n">red_L_nans</span><span class="p">,</span> <span class="n">red_R_nans</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">green_no_red</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">green_no_red</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_no_red</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]],</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">green_no_red</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">green_led</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="n">too_separated_inds</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">,</span>
        <span class="p">(</span>
            <span class="n">g_c_is_too_separated</span><span class="p">,</span>
            <span class="n">l_r_is_too_separated</span><span class="p">,</span>
            <span class="n">l_g_is_too_separated</span><span class="p">,</span>
            <span class="n">r_g_is_too_separated</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">too_separated_inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">too_separated_inds</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">centroid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.get_span_start_stop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_span_start_stop</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span></code>

<a href="#src.spyglass.position.v1.position_dlc_centroid.get_span_start_stop" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p><em>summary</em></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>indices</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>_type_</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><em>description</em></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/position/v1/dlc_utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_span_start_stop</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    indices : _type_</span>
<span class="sd">        _description_</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    _type_</span>
<span class="sd">        _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">span_inds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Get start and stop index of spans of consecutive indices</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">g</span><span class="p">))</span>
        <span class="n">span_inds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">span_inds</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.two_pt_centroid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">two_pt_centroid</span><span class="p">(</span><span class="n">pos_df</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></code>

<a href="#src.spyglass.position.v1.position_dlc_centroid.two_pt_centroid" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Determines the centroid of 2 points using (point1 + point2) / 2
For a given timestamp, if one point is NaN,
then the other point is assigned as the centroid.
If both are NaN, the centroid is NaN</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos_df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dataframe containing x and y position for each point of interest,
index is timestamps. Column names specified by params</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>**params</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>contains 'point1' and 'point2' keys,
whose values specify the column names in <code>pos_df</code></p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>centroid</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>numpy array with shape (n_time, 2)
centroid[0] is the x coord and centroid[1] is the y coord</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">two_pt_centroid</span><span class="p">(</span><span class="n">pos_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the centroid of 2 points using (point1 + point2) / 2</span>
<span class="sd">    For a given timestamp, if one point is NaN,</span>
<span class="sd">    then the other point is assigned as the centroid.</span>
<span class="sd">    If both are NaN, the centroid is NaN</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos_df : pd.DataFrame</span>
<span class="sd">        dataframe containing x and y position for each point of interest,</span>
<span class="sd">        index is timestamps. Column names specified by params</span>
<span class="sd">    **params : dict</span>
<span class="sd">        contains &#39;point1&#39; and &#39;point2&#39; keys,</span>
<span class="sd">        whose values specify the column names in `pos_df`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    centroid : np.ndarray</span>
<span class="sd">        numpy array with shape (n_time, 2)</span>
<span class="sd">        centroid[0] is the x coord and centroid[1] is the y coord</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_df</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">PT1</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;point1&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">PT2</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;point2&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">pt1_nans</span> <span class="o">=</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pt2_nans</span> <span class="o">=</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dist_between_points</span> <span class="o">=</span> <span class="n">get_distance</span><span class="p">(</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
        <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT2</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">is_too_separated</span> <span class="o">=</span> <span class="n">dist_between_points</span> <span class="o">&gt;=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;max_LED_separation&quot;</span><span class="p">]</span>
    <span class="n">all_good_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">pt1_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">pt2_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">is_too_separated</span><span class="p">)</span>
    <span class="n">centroid</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT1</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
                <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT2</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span>
                <span class="o">+</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">all_good_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT2</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># If only point1 is good</span>
    <span class="n">pt1_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">pt1_nans</span><span class="p">,</span> <span class="n">pt2_nans</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pt1_mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">pt1_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">pt1_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT1</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]],</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">pt1_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If only point2 is good</span>
    <span class="n">pt2_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">pt1_nans</span><span class="p">,</span> <span class="o">~</span><span class="n">pt2_nans</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pt2_mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">centroid</span><span class="p">[</span><span class="n">pt2_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="nb">zip</span><span class="p">(</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">pt2_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT2</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]],</span>
                <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">pt2_mask</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT2</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># If neither point is not NaN</span>
    <span class="n">all_bad_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">pt1_nans</span><span class="p">,</span> <span class="n">pt2_nans</span><span class="p">)</span>
    <span class="n">centroid</span><span class="p">[</span><span class="n">all_bad_mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="c1"># If LEDs are too far apart</span>
    <span class="n">centroid</span><span class="p">[</span><span class="n">is_too_separated</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">centroid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="src.spyglass.position.v1.position_dlc_centroid.one_pt_centroid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">one_pt_centroid</span><span class="p">(</span><span class="n">pos_df</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></code>

<a href="#src.spyglass.position.v1.position_dlc_centroid.one_pt_centroid" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Passes through the provided point as the centroid
For a given timestamp, if the point is NaN,
then the centroid is NaN</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos_df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dataframe containing x and y position for the point of interest,
index is timestamps. Column name specified by params</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>contains a 'point1' key,
whose value specifies the column name in <code>pos_df</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>centroid</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>numpy array with shape (n_time, 2)
centroid[0] is the x coord and centroid[1] is the y coord</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/spyglass/position/v1/position_dlc_centroid.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">one_pt_centroid</span><span class="p">(</span><span class="n">pos_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Passes through the provided point as the centroid</span>
<span class="sd">    For a given timestamp, if the point is NaN,</span>
<span class="sd">    then the centroid is NaN</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos_df : pd.DataFrame</span>
<span class="sd">        dataframe containing x and y position for the point of interest,</span>
<span class="sd">        index is timestamps. Column name specified by params</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        contains a &#39;point1&#39; key,</span>
<span class="sd">        whose value specifies the column name in `pos_df`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    centroid : np.ndarray</span>
<span class="sd">        numpy array with shape (n_time, 2)</span>
<span class="sd">        centroid[0] is the x coord and centroid[1] is the y coord</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
    <span class="n">PT1</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;point1&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">pos_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="n">PT1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">centroid</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../dlc_utils/" class="md-footer__link md-footer__link--prev" aria-label="Previous: dlc_utils.py" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                dlc_utils.py
              </div>
            </div>
          </a>
        
        
          
          <a href="../position_dlc_cohort/" class="md-footer__link md-footer__link--next" aria-label="Next: position_dlc_cohort.py" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                position_dlc_cohort.py
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2020-present Loren Frank
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/LorenFrankLab/spyglass" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/spyglass-neuro/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["toc.integrate", "navigation.sections", "navigation.expand", "navigation.top", "navigation.instant", "navigation.tracking", "navigation.top", "search.suggest", "search.share", "navigation.footer"], "search": "../../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.b425cdc4.min.js"></script>
      
    
  </body>
</html>